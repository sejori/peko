(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["vendors-node_modules_optimizely_optimizely-sdk_dist_optimizely_browser_es_min_js-node_modules-4de5ed"],{53949(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(13196),e=function(){function a(){this.errorCount=0}return a.prototype.getDelay=function(){return 0===this.errorCount?0:1e3*d.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT[Math.min(d.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1,this.errorCount)]+Math.round(1e3*Math.random())},a.prototype.countError=function(){this.errorCount<d.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT.length-1&&this.errorCount++},a.prototype.reset=function(){this.errorCount=0},a}();b.default=e},20731:function(a,b,c){"use strict";var d,e=this&&this.__extends||(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)},function(a,b){function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),f=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b,"__esModule",{value:!0});var g=c(80064),h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.makeGetRequest=function(a,b){return g.makeGetRequest(a,b)},b.prototype.getConfigDefaults=function(){return{autoUpdate:!1}},b}(f(c(20377)).default);b.default=h},80064(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(13196),e=c(98125).getLogger("DatafileManager");b.makeGetRequest=function(a,b){var c=new XMLHttpRequest;return{responsePromise:new Promise(function(f,g){c.open("GET",a,!0),function(a,b){Object.keys(a).forEach(function(c){var d=a[c];b.setRequestHeader(c,d)})}(b,c),c.onreadystatechange=function(){if(4===c.readyState){if(0===c.status){g(Error("Request error"));return}var a=function(a){var b=a.getAllResponseHeaders();if(null===b)return{};var c=b.split("\r\n"),d={};return c.forEach(function(a){var b=a.indexOf(": ");if(b> -1){var c=a.slice(0,b),e=a.slice(b+2);e.length>0&&(d[c]=e)}}),d}(c),b={statusCode:c.status,body:c.responseText,headers:a};f(b)}},c.timeout=d.REQUEST_TIMEOUT_MS,c.ontimeout=function(){e.error("Request timed out")},c.send()}),abort:function(){c.abort()}}}},13196(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.DEFAULT_UPDATE_INTERVAL=3e5,b.MIN_UPDATE_INTERVAL=1e3,b.DEFAULT_URL_TEMPLATE="https://cdn.optimizely.com/datafiles/%s.json",b.DEFAULT_AUTHENTICATED_URL_TEMPLATE="https://config.optimizely.com/datafiles/auth/%s.json",b.BACKOFF_BASE_WAIT_SECONDS_BY_ERROR_COUNT=[0,8,16,32,64,128,256,512],b.REQUEST_TIMEOUT_MS=6e4},10181(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.listeners={},this.listenerId=1}return a.prototype.on=function(a,b){var c=this;this.listeners[a]||(this.listeners[a]={});var d=String(this.listenerId);return this.listenerId++,this.listeners[a][d]=b,function(){c.listeners[a]&&delete c.listeners[a][d]}},a.prototype.emit=function(a,b){var c=this.listeners[a];c&&Object.keys(c).forEach(function(a){(0,c[a])(b)})},a.prototype.removeAllListeners=function(){this.listeners={}},a}();b.default=c},20377:function(a,b,c){"use strict";var d=this&&this.__assign||function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},e=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b,"__esModule",{value:!0});var f=c(98125),g=c(27378),h=e(c(10181)),i=c(13196),j=e(c(53949)),k=f.getLogger("DatafileManager");function l(a){return a>=200&&a<400}var m={get:function(){return Promise.resolve("")},set:function(){return Promise.resolve()},contains:function(){return Promise.resolve(!1)},remove:function(){return Promise.resolve()}},n=function(){function a(a){var b,c=this,e=d(d({},this.getConfigDefaults()),a),f=e.datafile,l=e.autoUpdate,n=e.sdkKey,o=e.updateInterval,p=void 0===o?i.DEFAULT_UPDATE_INTERVAL:o,q=e.urlTemplate,r=void 0===q?i.DEFAULT_URL_TEMPLATE:q,s=e.cache;(this.cache=void 0===s?m:s,this.cacheKey="opt-datafile-"+n,this.isReadyPromiseSettled=!1,this.readyPromiseResolver=function(){},this.readyPromiseRejecter=function(){},this.readyPromise=new Promise(function(a,b){c.readyPromiseResolver=a,c.readyPromiseRejecter=b}),f?(this.currentDatafile=f,n||this.resolveReadyPromise()):this.currentDatafile="",this.isStarted=!1,this.datafileUrl=g.sprintf(r,n),this.emitter=new h.default,this.autoUpdate=void 0!==l&&l,(b=p)>=i.MIN_UPDATE_INTERVAL)?this.updateInterval=p:(k.warn("Invalid updateInterval %s, defaulting to %s",p,i.DEFAULT_UPDATE_INTERVAL),this.updateInterval=i.DEFAULT_UPDATE_INTERVAL),this.currentTimeout=null,this.currentRequest=null,this.backoffController=new j.default,this.syncOnCurrentRequestComplete=!1}return a.prototype.get=function(){return this.currentDatafile},a.prototype.start=function(){this.isStarted||(k.debug("Datafile manager started"),this.isStarted=!0,this.backoffController.reset(),this.setDatafileFromCacheIfAvailable(),this.syncDatafile())},a.prototype.stop=function(){return k.debug("Datafile manager stopped"),this.isStarted=!1,this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),this.emitter.removeAllListeners(),this.currentRequest&&(this.currentRequest.abort(),this.currentRequest=null),Promise.resolve()},a.prototype.onReady=function(){return this.readyPromise},a.prototype.on=function(a,b){return this.emitter.on(a,b)},a.prototype.onRequestRejected=function(a){this.isStarted&&(this.backoffController.countError(),a instanceof Error?k.error("Error fetching datafile: %s",a.message,a):"string"==typeof a?k.error("Error fetching datafile: %s",a):k.error("Error fetching datafile"))},a.prototype.onRequestResolved=function(a){if(this.isStarted){void 0!==a.statusCode&&l(a.statusCode)?this.backoffController.reset():this.backoffController.countError(),this.trySavingLastModified(a.headers);var b=this.getNextDatafileFromResponse(a);if(""!==b){if(k.info("Updating datafile from response"),this.currentDatafile=b,this.cache.set(this.cacheKey,b),this.isReadyPromiseSettled){var c={datafile:b};this.emitter.emit("update",c)}else this.resolveReadyPromise()}}},a.prototype.onRequestComplete=function(){this.isStarted&&(this.currentRequest=null,this.isReadyPromiseSettled||this.autoUpdate||this.rejectReadyPromise(Error("Failed to become ready")),this.autoUpdate&&this.syncOnCurrentRequestComplete&&this.syncDatafile(),this.syncOnCurrentRequestComplete=!1)},a.prototype.syncDatafile=function(){var a=this,b={};this.lastResponseLastModified&&(b["if-modified-since"]=this.lastResponseLastModified),k.debug("Making datafile request to url %s with headers: %s",this.datafileUrl,function(){return JSON.stringify(b)}),this.currentRequest=this.makeGetRequest(this.datafileUrl,b);var c=function(){a.onRequestComplete()};this.currentRequest.responsePromise.then(function(b){a.onRequestResolved(b)},function(b){a.onRequestRejected(b)}).then(c,c),this.autoUpdate&&this.scheduleNextUpdate()},a.prototype.resolveReadyPromise=function(){this.readyPromiseResolver(),this.isReadyPromiseSettled=!0},a.prototype.rejectReadyPromise=function(a){this.readyPromiseRejecter(a),this.isReadyPromiseSettled=!0},a.prototype.scheduleNextUpdate=function(){var a=this,b=Math.max(this.backoffController.getDelay(),this.updateInterval);k.debug("Scheduling sync in %s ms",b),this.currentTimeout=setTimeout(function(){a.currentRequest?a.syncOnCurrentRequestComplete=!0:a.syncDatafile()},b)},a.prototype.getNextDatafileFromResponse=function(a){return(k.debug("Response status code: %s",a.statusCode),void 0===a.statusCode||304===a.statusCode)?"":l(a.statusCode)?a.body:""},a.prototype.trySavingLastModified=function(a){var b=a["last-modified"]||a["Last-Modified"];void 0!==b&&(this.lastResponseLastModified=b,k.debug("Saved last modified header value from response: %s",this.lastResponseLastModified))},a.prototype.setDatafileFromCacheIfAvailable=function(){var a=this;this.cache.get(this.cacheKey).then(function(b){a.isStarted&&!a.isReadyPromiseSettled&&""!==b&&(k.debug("Using datafile from cache"),a.currentDatafile=b,a.resolveReadyPromise())})},a}();b.default=n},62002(a,b,c){"use strict";var d=c(20731);b.z=d.default},67473(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})},24909(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.sendEventNotification=b.getQueue=b.validateAndGetBatchSize=b.validateAndGetFlushInterval=b.DEFAULT_BATCH_SIZE=b.DEFAULT_FLUSH_INTERVAL=void 0;var d=c(31459),e=c(98125),f=c(27378);b.DEFAULT_FLUSH_INTERVAL=3e4,b.DEFAULT_BATCH_SIZE=10;var g=e.getLogger("EventProcessor");b.validateAndGetFlushInterval=function(a){return a<=0&&(g.warn("Invalid flushInterval "+a+", defaulting to "+b.DEFAULT_FLUSH_INTERVAL),a=b.DEFAULT_FLUSH_INTERVAL),a},b.validateAndGetBatchSize=function(a){return(a=Math.floor(a))<1&&(g.warn("Invalid batchSize "+a+", defaulting to "+b.DEFAULT_BATCH_SIZE),a=b.DEFAULT_BATCH_SIZE),a=Math.max(1,a)},b.getQueue=function(a,b,c,e){var f;return a>1?new d.DefaultEventQueue({flushInterval:b,maxQueueSize:a,sink:c,batchComparator:e}):new d.SingleEventQueue({sink:c})},b.sendEventNotification=function(a,b){a&&a.sendNotifications(f.NOTIFICATION_TYPES.LOG_EVENT,b)}},31459(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.DefaultEventQueue=b.SingleEventQueue=void 0;var d=c(98125).getLogger("EventProcessor"),e=function(){function a(a){var b=a.timeout,c=a.callback;this.timeout=Math.max(b,0),this.callback=c}return a.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},a.prototype.refresh=function(){this.stop(),this.start()},a.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},a}(),f=function(){function a(a){var b=a.sink;this.sink=b}return a.prototype.start=function(){},a.prototype.stop=function(){return Promise.resolve()},a.prototype.enqueue=function(a){this.sink([a])},a}();b.SingleEventQueue=f;var g=function(){function a(a){var b=a.flushInterval,c=a.maxQueueSize,d=a.sink,f=a.batchComparator;this.buffer=[],this.maxQueueSize=Math.max(c,1),this.sink=d,this.batchComparator=f,this.timer=new e({callback:this.flush.bind(this),timeout:b}),this.started=!1}return a.prototype.start=function(){this.started=!0},a.prototype.stop=function(){this.started=!1;var a=this.sink(this.buffer);return this.buffer=[],this.timer.stop(),a},a.prototype.enqueue=function(a){if(!this.started){d.warn("Queue is stopped, not accepting event");return}var b=this.buffer[0];b&&!this.batchComparator(b,a)&&this.flush(),0===this.buffer.length&&this.timer.refresh(),this.buffer.push(a),this.buffer.length>=this.maxQueueSize&&this.flush()},a.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},a}();b.DefaultEventQueue=g},51074(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.areEventContextsEqual=void 0,b.areEventContextsEqual=function(a,b){var c=a.context,d=b.context;return c.accountId===d.accountId&&c.projectId===d.projectId&&c.clientName===d.clientName&&c.clientVersion===d.clientVersion&&c.revision===d.revision&&c.anonymizeIP===d.anonymizeIP&&c.botFiltering===d.botFiltering}},65001:function(a,b,c){"use strict";var d=this&&this.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c),Object.defineProperty(a,d,{enumerable:!0,get:function(){return b[c]}})}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=this&&this.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(b,"__esModule",{value:!0}),e(c(51074),b),e(c(24909),b),e(c(67473),b),e(c(21310),b),e(c(36896),b),e(c(97168),b),e(c(18994),b)},21310(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0})},36896:function(a,b,c){"use strict";var d,e=this&&this.__extends||(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)},function(a,b){function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)});Object.defineProperty(b,"__esModule",{value:!0}),b.LocalStoragePendingEventsDispatcher=b.PendingEventsDispatcher=void 0;var f=c(98125),g=c(36587),h=c(27378),i=f.getLogger("EventProcessor"),j=function(){function a(a){var b=a.eventDispatcher,c=a.store;this.dispatcher=b,this.store=c}return a.prototype.dispatchEvent=function(a,b){this.send({uuid:h.generateUUID(),timestamp:h.getTimestamp(),request:a},b)},a.prototype.sendPendingEvents=function(){var a=this,b=this.store.values();i.debug("Sending %s pending events from previous page",b.length),b.forEach(function(b){try{a.send(b,function(){})}catch(c){}})},a.prototype.send=function(a,b){var c=this;this.store.set(a.uuid,a),this.dispatcher.dispatchEvent(a.request,function(d){c.store.remove(a.uuid),b(d)})},a}();b.PendingEventsDispatcher=j;var k=function(a){function b(b){var c=b.eventDispatcher;return a.call(this,{eventDispatcher:c,store:new g.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return e(b,a),b}(j);b.LocalStoragePendingEventsDispatcher=k},36587(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.LocalStorageStore=void 0;var d=c(27378),e=c(98125).getLogger("EventProcessor"),f=function(){function a(a){var b=a.key,c=a.maxValues;this.LS_KEY=b,this.maxValues=void 0===c?1e3:c}return a.prototype.get=function(a){return this.getMap()[a]||null},a.prototype.set=function(a,b){var c=this.getMap();c[a]=b,this.replace(c)},a.prototype.remove=function(a){var b=this.getMap();delete b[a],this.replace(b)},a.prototype.values=function(){return d.objectValues(this.getMap())},a.prototype.clear=function(){this.replace({})},a.prototype.replace=function(a){try{window.localStorage&&localStorage.setItem(this.LS_KEY,JSON.stringify(a)),this.clean()}catch(b){e.error(b)}},a.prototype.clean=function(){var a=this.getMap(),b=Object.keys(a),c=b.length-this.maxValues;if(!(c<1)){var d=b.map(function(b){return{key:b,value:a[b]}});d.sort(function(a,b){return a.value.timestamp-b.value.timestamp});for(var e=0;e<c;e++)delete a[d[e].key];this.replace(a)}},a.prototype.getMap=function(){try{var a=window.localStorage&&localStorage.getItem(this.LS_KEY);if(a)return JSON.parse(a)||{}}catch(b){e.error(b)}return{}},a}();b.LocalStorageStore=f},90522(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){this.reqsInFlightCount=0,this.reqsCompleteResolvers=[]}return a.prototype.trackRequest=function(a){var b=this;this.reqsInFlightCount++;var c=function(){b.reqsInFlightCount--,0===b.reqsInFlightCount&&(b.reqsCompleteResolvers.forEach(function(a){return a()}),b.reqsCompleteResolvers=[])};a.then(c,c)},a.prototype.onRequestsComplete=function(){var a=this;return new Promise(function(b){0===a.reqsInFlightCount?b():a.reqsCompleteResolvers.push(b)})},a}();b.default=c},97168:function(a,b){"use strict";var c=this&&this.__assign||function(){return(c=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0}),b.formatEvents=b.buildConversionEventV1=b.buildImpressionEventV1=b.makeBatchedEventV1=void 0;var d="$opt_bot_filtering";function e(a){var b=[],c=a[0];return a.forEach(function(a){if("conversion"===a.type||"impression"===a.type){var c=h(a);"impression"===a.type?c.snapshots.push(g(a)):"conversion"===a.type&&c.snapshots.push(f(a)),b.push(c)}}),{client_name:c.context.clientName,client_version:c.context.clientVersion,account_id:c.context.accountId,project_id:c.context.projectId,revision:c.context.revision,anonymize_ip:c.context.anonymizeIP,enrich_decisions:!0,visitors:b}}function f(a){var b=c({},a.tags);delete b.revenue,delete b.value;var d={entity_id:a.event.id,key:a.event.key,timestamp:a.timestamp,uuid:a.uuid};return a.tags&&(d.tags=a.tags),null!=a.value&&(d.value=a.value),null!=a.revenue&&(d.revenue=a.revenue),{events:[d]}}function g(a){var b,c,d=a.layer,e=a.experiment,f=a.variation,g=a.ruleKey,h=a.flagKey,i=a.ruleType,j=a.enabled,k=d?d.id:null,l=null!==(b=null==e?void 0:e.id)&& void 0!==b?b:"",m=null!==(c=null==f?void 0:f.id)&& void 0!==c?c:"",n=f?f.key:"";return{decisions:[{campaign_id:k,experiment_id:l,variation_id:m,metadata:{flag_key:h,rule_key:g,rule_type:i,variation_key:n,enabled:j}},],events:[{entity_id:k,timestamp:a.timestamp,key:"campaign_activated",uuid:a.uuid},]}}function h(a){var b={snapshots:[],visitor_id:a.user.id,attributes:[]};return a.user.attributes.forEach(function(a){b.attributes.push({entity_id:a.entityId,key:a.key,type:"custom",value:a.value})}),"boolean"==typeof a.context.botFiltering&&b.attributes.push({entity_id:d,key:d,type:"custom",value:a.context.botFiltering}),b}b.makeBatchedEventV1=e,b.buildImpressionEventV1=function(a){var b=h(a);return b.snapshots.push(g(a)),{client_name:a.context.clientName,client_version:a.context.clientVersion,account_id:a.context.accountId,project_id:a.context.projectId,revision:a.context.revision,anonymize_ip:a.context.anonymizeIP,enrich_decisions:!0,visitors:[b]}},b.buildConversionEventV1=function(a){var b=h(a);return b.snapshots.push(f(a)),{client_name:a.context.clientName,client_version:a.context.clientVersion,account_id:a.context.accountId,project_id:a.context.projectId,revision:a.context.revision,anonymize_ip:a.context.anonymizeIP,enrich_decisions:!0,visitors:[b]}},b.formatEvents=function(a){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:e(a)}}},18994:function(a,b,c){"use strict";var d=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(b){f(b)}}function h(a){try{i(d.throw(a))}catch(b){f(b)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},e=this&&this.__generator||function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(a){return function(b){return i([a,b])}}function i(f){if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&f[0]?d.return:f[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,f[1])).done)return e;switch(d=0,e&&(f=[2&f[0],e.value]),f[0]){case 0:case 1:e=f;break;case 4:return g.label++,{value:f[1],done:!1};case 5:g.label++,d=f[1],f=[0];continue;case 7:f=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===f[0]||2===f[0])){g=0;continue}if(3===f[0]&&(!e||f[1]>e[0]&&f[1]<e[3])){g.label=f[1];break}if(6===f[0]&&g.label<e[1]){g.label=e[1],e=f;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(f);break}e[2]&&g.ops.pop(),g.trys.pop();continue}f=b.call(a,g)}catch(h){f=[6,h],d=0}finally{c=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},f=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(b,"__esModule",{value:!0}),b.LogTierV1EventProcessor=void 0;var g=c(98125),h=c(24909),i=f(c(90522)),j=c(51074),k=c(97168),l=g.getLogger("LogTierV1EventProcessor"),m=function(){function a(a){var b=a.dispatcher,c=a.flushInterval,d=void 0===c?h.DEFAULT_FLUSH_INTERVAL:c,e=a.batchSize,f=void 0===e?h.DEFAULT_BATCH_SIZE:e,g=a.notificationCenter;this.dispatcher=b,this.notificationCenter=g,this.requestTracker=new i.default,d=h.validateAndGetFlushInterval(d),f=h.validateAndGetBatchSize(f),this.queue=h.getQueue(f,d,this.drainQueue.bind(this),j.areEventContextsEqual)}return a.prototype.drainQueue=function(a){var b=this,c=new Promise(function(c){if(l.debug("draining queue with %s events",a.length),0===a.length){c();return}var d=k.formatEvents(a);b.dispatcher.dispatchEvent(d,function(){c()}),h.sendEventNotification(b.notificationCenter,d)});return this.requestTracker.trackRequest(c),c},a.prototype.process=function(a){this.queue.enqueue(a)},a.prototype.stop=function(){try{return this.queue.stop(),this.requestTracker.onRequestsComplete()}catch(a){l.error('Error stopping EventProcessor: "%s"',a.message,a)}return Promise.resolve()},a.prototype.start=function(){return d(this,void 0,void 0,function(){return e(this,function(a){return this.queue.start(),[2]})})},a}();b.LogTierV1EventProcessor=m},27987(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){}return a.prototype.handleError=function(a){},a}();b.NoopErrorHandler=c;var d=new c;function e(a){d=a}function f(){return d}b.setErrorHandler=e,b.getErrorHandler=f,b.resetErrorHandler=function(){d=new c}},98125(a,b,c){"use strict";function d(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])}Object.defineProperty(b,"__esModule",{value:!0}),d(c(27987)),d(c(99623)),d(c(46773))},46773:function(a,b,c){"use strict";var d=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d};Object.defineProperty(b,"__esModule",{value:!0});var e=c(27987),f=c(27378),g=c(99623),h={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function i(a){return"string"!=typeof a?a:("WARN"===(a=a.toUpperCase())&&(a="WARNING"),h[a])?h[a]:a}var j=function(){function a(){this.defaultLoggerFacade=new n,this.loggers={}}return a.prototype.getLogger=function(a){return a?(this.loggers[a]||(this.loggers[a]=new n({messagePrefix:a})),this.loggers[a]):this.defaultLoggerFacade},a}(),k=function(){function a(a){void 0===a&&(a={}),this.logLevel=g.LogLevel.NOTSET,void 0!==a.logLevel&&f.isValidEnum(g.LogLevel,a.logLevel)&&this.setLogLevel(a.logLevel),this.logToConsole=void 0===a.logToConsole||!!a.logToConsole,this.prefix=void 0!==a.prefix?a.prefix:"[OPTIMIZELY]"}return a.prototype.log=function(a,b){if(this.shouldLog(a)&&this.logToConsole){var c=this.prefix+" - "+this.getLogLevelName(a)+" "+this.getTime()+" "+b;this.consoleLog(a,[c])}},a.prototype.setLogLevel=function(a){a=i(a),f.isValidEnum(g.LogLevel,a)&& void 0!==a?this.logLevel=a:this.logLevel=g.LogLevel.ERROR},a.prototype.getTime=function(){return new Date().toISOString()},a.prototype.shouldLog=function(a){return a>=this.logLevel},a.prototype.getLogLevelName=function(a){switch(a){case g.LogLevel.DEBUG:return"DEBUG";case g.LogLevel.INFO:return"INFO ";case g.LogLevel.WARNING:return"WARN ";case g.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},a.prototype.consoleLog=function(a,b){switch(a){case g.LogLevel.DEBUG:console.log.apply(console,b);break;case g.LogLevel.INFO:console.info.apply(console,b);break;case g.LogLevel.WARNING:console.warn.apply(console,b);break;case g.LogLevel.ERROR:console.error.apply(console,b);break;default:console.log.apply(console,b)}},a}();b.ConsoleLogHandler=k;var l=g.LogLevel.NOTSET,m=null,n=function(){function a(a){void 0===a&&(a={}),this.messagePrefix="",a.messagePrefix&&(this.messagePrefix=a.messagePrefix)}return a.prototype.log=function(a,b){for(var c=[],d=2;d<arguments.length;d++)c[d-2]=arguments[d];this.internalLog(i(a),{message:b,splat:c})},a.prototype.info=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.namedLog(g.LogLevel.INFO,a,b)},a.prototype.debug=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.namedLog(g.LogLevel.DEBUG,a,b)},a.prototype.warn=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.namedLog(g.LogLevel.WARNING,a,b)},a.prototype.error=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.namedLog(g.LogLevel.ERROR,a,b)},a.prototype.format=function(a){return(this.messagePrefix?this.messagePrefix+": ":"")+f.sprintf.apply(void 0,d([a.message],a.splat))},a.prototype.internalLog=function(a,b){m&&!(a<l)&&(m.log(a,this.format(b)),b.error&&b.error instanceof Error&&e.getErrorHandler().handleError(b.error))},a.prototype.namedLog=function(a,b,c){if(b instanceof Error){b=(d=b).message,this.internalLog(a,{error:d,message:b,splat:c});return}if(0===c.length){this.internalLog(a,{message:b,splat:c});return}var d,e=c[c.length-1];e instanceof Error&&(d=e,c.splice(-1)),this.internalLog(a,{message:b,error:d,splat:c})},a}(),o=new j;function p(a){m=a}function q(){return l}b.getLogger=function(a){return o.getLogger(a)},b.setLogHandler=p,b.setLogLevel=function(a){a=i(a),l=f.isValidEnum(g.LogLevel,a)&& void 0!==a?a:g.LogLevel.ERROR},b.getLogLevel=q,b.resetLogger=function(){o=new j,l=g.LogLevel.NOTSET}},99623(a,b){"use strict";var c;Object.defineProperty(b,"__esModule",{value:!0}),(c=b.LogLevel||(b.LogLevel={}))[c.NOTSET=0]="NOTSET",c[c.DEBUG=1]="DEBUG",c[c.INFO=2]="INFO",c[c.WARNING=3]="WARNING",c[c.ERROR=4]="ERROR"},27378(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d,e=c(328);function f(a){return Object.keys(a).map(function(b){return a[b]})}b.generateUUID=function(){return e.v4()},b.getTimestamp=function(){return new Date().getTime()},b.isValidEnum=function(a,b){for(var c=!1,d=Object.keys(a),e=0;e<d.length;e++)if(b===a[d[e]]){c=!0;break}return c},b.groupBy=function(a,b){var c={};return a.forEach(function(a){var d=b(a);c[d]=c[d]||[],c[d].push(a)}),f(c)},b.objectValues=f,b.objectEntries=function(a){return Object.keys(a).map(function(b){return[b,a[b]]})},b.find=function(a,b){for(var c,d=0,e=a;d<e.length;d++){var f=e[d];if(b(f)){c=f;break}}return c},b.keyBy=function(a,b){var c={};return a.forEach(function(a){c[b(a)]=a}),c},b.sprintf=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=0;return a.replace(/%s/g,function(){var a=b[d++],c=typeof a;return"function"===c?a():"string"===c?a:String(a)})},(d=b.NOTIFICATION_TYPES||(b.NOTIFICATION_TYPES={})).ACTIVATE="ACTIVATE:experiment, user_id,attributes, variation, event",d.DECISION="DECISION:type, userId, attributes, decisionInfo",d.LOG_EVENT="LOG_EVENT:logEvent",d.OPTIMIZELY_CONFIG_UPDATE="OPTIMIZELY_CONFIG_UPDATE",d.TRACK="TRACK:event_key, user_id, attributes, event_tags, event"},48266(a,b,c){"use strict";c.d(b,{ZP:()=>aV});var d,e,f=c(98125),g=c(65001),h=c(27378),i=c(58053),j=c.n(i),k=c(62002),l=function(){return(l=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function m(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;var d=Array(a),e=0;for(b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}var n={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},o={CONDITION_EVALUATOR_ERROR:"%s: Error evaluating audience condition of type %s: %s",DATAFILE_AND_SDK_KEY_MISSING:"%s: You must provide at least one of sdkKey or datafile. Cannot start Optimizely",EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_CONFIG:"%s: Provided Optimizely config is in an invalid format.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},p={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EVENT_KEY_NOT_FOUND:"%s: Event key %s is not in datafile.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_DEFAULT_DECIDE_OPTIONS:"%s: Provided default decide options is not an array.",INVALID_DECIDE_OPTIONS:"%s: Provided decide options is not an array. Using default decide options.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is not in "Running" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",UNRECOGNIZED_DECIDE_OPTION:"%s: Unrecognized decide option %s provided.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned bucket %s to user with bucketing ID %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED:"Variation (%s) is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s), rule (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID:"Invalid variation is mapped to flag (%s) and user (%s) in the forced decision map.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning the default variable value "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Got variable value "%s" for variable "%s" of feature flag "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for %s "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for %s %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",UPDATED_OPTIMIZELY_CONFIG:"%s: Updated Optimizely config to revision %s (project id %s)",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].',UNABLE_TO_ATTACH_UNLOAD:'%s: unable to bind optimizely.close() to page unload event: "%s"'},q={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent",FORCED_DECISION_NULL_RULE_KEY:"$opt_null_rule_key"},r=h.NOTIFICATION_TYPES,s={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable",ALL_FEATURE_VARIABLES:"all-feature-variables",FLAG:"flag"},t={FEATURE_TEST:"feature-test",ROLLOUT:"rollout",EXPERIMENT:"experiment"},u={RULE:"rule",EXPERIMENT:"experiment"},v={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string",JSON:"json"},w={V2:"2",V3:"3",V4:"4"},x={SDK_NOT_READY:"Optimizely SDK not configured properly yet.",FLAG_KEY_INVALID:'No flag was found for key "%s".',VARIABLE_VALUE_INVALID:'Variable value for key "%s" is invalid or wrong type.'},y=Object.freeze({__proto__:null,LOG_LEVEL:n,ERROR_MESSAGES:o,LOG_MESSAGES:p,CONTROL_ATTRIBUTES:q,JAVASCRIPT_CLIENT_ENGINE:"javascript-sdk",NODE_CLIENT_ENGINE:"node-sdk",REACT_CLIENT_ENGINE:"react-sdk",REACT_NATIVE_CLIENT_ENGINE:"react-native-sdk",REACT_NATIVE_JS_CLIENT_ENGINE:"react-native-js-sdk",NODE_CLIENT_VERSION:"4.9.1",NOTIFICATION_TYPES:r,DECISION_NOTIFICATION_TYPES:s,DECISION_SOURCES:t,AUDIENCE_EVALUATION_TYPES:u,FEATURE_VARIABLE_TYPES:v,DATAFILE_VERSIONS:w,DECISION_MESSAGES:x}),z="CONFIG_VALIDATOR",A=[w.V2,w.V3,w.V4],B=function(a){if("object"==typeof a&&null!==a){var b=a,c=b.errorHandler,d=b.eventDispatcher,e=b.logger;if(c&&"function"!=typeof c.handleError)throw Error((0,h.sprintf)(o.INVALID_ERROR_HANDLER,z));if(d&&"function"!=typeof d.dispatchEvent)throw Error((0,h.sprintf)(o.INVALID_EVENT_DISPATCHER,z));if(e&&"function"!=typeof e.log)throw Error((0,h.sprintf)(o.INVALID_LOGGER,z));return!0}throw Error((0,h.sprintf)(o.INVALID_CONFIG,z))},C=function(a){if(!a)throw Error((0,h.sprintf)(o.NO_DATAFILE_SPECIFIED,z));if("string"==typeof a)try{a=JSON.parse(a)}catch(b){throw Error((0,h.sprintf)(o.INVALID_DATAFILE_MALFORMED,z))}if("object"==typeof a&&!Array.isArray(a)&&null!==a&& -1===A.indexOf(a.version))throw Error((0,h.sprintf)(o.INVALID_DATAFILE_VERSION,z,a.version));return a},D={dispatchEvent:function(a,b){var c,d,e=a.params,f=a.url;"POST"===a.httpVerb?((c=new XMLHttpRequest).open("POST",f,!0),c.setRequestHeader("Content-Type","application/json"),c.onreadystatechange=function(){if(4===c.readyState&&b&&"function"==typeof b)try{b({statusCode:c.status})}catch(a){}},c.send(JSON.stringify(e))):(f+="?wxhr=true",e&&(f+="&"+Object.keys(d=e).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(d[a])}).join("&")),(c=new XMLHttpRequest).open("GET",f,!0),c.onreadystatechange=function(){if(4===c.readyState&&b&&"function"==typeof b)try{b({statusCode:c.status})}catch(a){}},c.send())}},E=function(){function a(){}return a.prototype.log=function(){},a}();function F(a){return new f.ConsoleLogHandler(a)}var G,H,I=Object.freeze({__proto__:null,NoOpLogger:E,createLogger:F,createNoOpLogger:function(){return new E}});function J(a,b,c){return{variationKey:null,enabled:!1,variables:{},ruleKey:null,flagKey:a,userContext:b,reasons:c}}(d=G||(G={})).BOOLEAN="boolean",d.DOUBLE="double",d.INTEGER="integer",d.STRING="string",d.JSON="json",(e=H||(H={})).DISABLE_DECISION_EVENT="DISABLE_DECISION_EVENT",e.ENABLED_FLAGS_ONLY="ENABLED_FLAGS_ONLY",e.IGNORE_USER_PROFILE_SERVICE="IGNORE_USER_PROFILE_SERVICE",e.INCLUDE_REASONS="INCLUDE_REASONS",e.EXCLUDE_VARIABLES="EXCLUDE_VARIABLES";var K=function(){function a(a){var b,c=a.optimizely,d=a.userId,e=a.attributes;this.optimizely=c,this.userId=d,this.attributes=null!==(b=l({},e))&& void 0!==b?b:{},this.forcedDecisionsMap={}}return a.prototype.setAttribute=function(a,b){this.attributes[a]=b},a.prototype.getUserId=function(){return this.userId},a.prototype.getAttributes=function(){return l({},this.attributes)},a.prototype.getOptimizely=function(){return this.optimizely},a.prototype.decide=function(a,b){return void 0===b&&(b=[]),this.optimizely.decide(this.cloneUserContext(),a,b)},a.prototype.decideForKeys=function(a,b){return void 0===b&&(b=[]),this.optimizely.decideForKeys(this.cloneUserContext(),a,b)},a.prototype.decideAll=function(a){return void 0===a&&(a=[]),this.optimizely.decideAll(this.cloneUserContext(),a)},a.prototype.trackEvent=function(a,b){this.optimizely.track(a,this.userId,this.attributes,b)},a.prototype.setForcedDecision=function(a,b){var c,d=a.flagKey,e=null!==(c=a.ruleKey)&& void 0!==c?c:q.FORCED_DECISION_NULL_RULE_KEY,f={variationKey:b.variationKey};return this.forcedDecisionsMap[d]||(this.forcedDecisionsMap[d]={}),this.forcedDecisionsMap[d][e]=f,!0},a.prototype.getForcedDecision=function(a){return this.findForcedDecision(a)},a.prototype.removeForcedDecision=function(a){var b,c=null!==(b=a.ruleKey)&& void 0!==b?b:q.FORCED_DECISION_NULL_RULE_KEY,d=a.flagKey,e=!1;return this.forcedDecisionsMap.hasOwnProperty(d)&&(this.forcedDecisionsMap[d].hasOwnProperty(c)&&(delete this.forcedDecisionsMap[d][c],e=!0),0===Object.keys(this.forcedDecisionsMap[d]).length&&delete this.forcedDecisionsMap[d]),e},a.prototype.removeAllForcedDecisions=function(){return this.forcedDecisionsMap={},!0},a.prototype.findForcedDecision=function(a){var b,c=null!==(b=a.ruleKey)&& void 0!==b?b:q.FORCED_DECISION_NULL_RULE_KEY,d=a.flagKey;if(this.forcedDecisionsMap.hasOwnProperty(a.flagKey)){var e=this.forcedDecisionsMap[d];if(e.hasOwnProperty(c))return{variationKey:e[c].variationKey}}return null},a.prototype.cloneUserContext=function(){var b=new a({optimizely:this.getOptimizely(),userId:this.getUserId(),attributes:this.getAttributes()});return Object.keys(this.forcedDecisionsMap).length>0&&(b.forcedDecisionsMap=l({},this.forcedDecisionsMap)),b},a}(),L=["and","or","not"];function M(a,b){if(Array.isArray(a)){var c=a[0],d=a.slice(1);switch("string"==typeof c&& -1===L.indexOf(c)&&(c="or",d=a),c){case"and":return function(a,b){var c=!1;if(Array.isArray(a)){for(var d=0;d<a.length;d++){var e=M(a[d],b);if(!1===e)return!1;null===e&&(c=!0)}return!c||null}return null}(d,b);case"not":return function(a,b){if(Array.isArray(a)&&a.length>0){var c=M(a[0],b);return null===c?null:!c}return null}(d,b);default:return function(a,b){var c=!1;if(Array.isArray(a)){for(var d=0;d<a.length;d++){var e=M(a[d],b);if(!0===e)return!0;null===e&&(c=!0)}return!!c&&null}return null}(d,b)}}return b(a)}var N=function(){function a(b,c){this.sdkKey=null!==(d=b.sdkKey)&& void 0!==d?d:"",this.environmentKey=null!==(e=b.environmentKey)&& void 0!==e?e:"",this.attributes=b.attributes,this.audiences=a.getAudiences(b),this.events=b.events,this.revision=b.revision;var d,e,f=(b.featureFlags||[]).reduce(function(a,b){return a[b.id]=b.variables,a},{}),g=a.getExperimentsMapById(b,f);this.experimentsMap=a.getExperimentsKeyMap(g),this.featuresMap=a.getFeaturesMap(b,f,g),this.datafile=c}return a.prototype.getDatafile=function(){return this.datafile},a.getAudiences=function(a){var b=[],c=[];return(a.typedAudiences||[]).forEach(function(a){b.push({id:a.id,conditions:JSON.stringify(a.conditions),name:a.name}),c.push(a.id)}),(a.audiences||[]).forEach(function(a){-1===c.indexOf(a.id)&&"$opt_dummy_audience"!=a.id&&b.push({id:a.id,conditions:JSON.stringify(a.conditions),name:a.name})}),b},a.getSerializedAudiences=function(b,c){var d="";if(b){var e="";b.forEach(function(b){var f="";if(b instanceof Array)f="("+(f=a.getSerializedAudiences(b,c))+")";else if(L.indexOf(b)> -1)e=b.toUpperCase();else{var g=c[b]?c[b].name:b;d||"NOT"===e?(e=""===e?"OR":e,d=""===d?e+' "'+c[b].name+'"':d.concat(" "+e+' "'+g+'"')):d='"'+g+'"'}""!==f&&(""!==d||"NOT"===e?(e=""===e?"OR":e,d=""===d?e+" "+f:d.concat(" "+e+" "+f)):d=d.concat(f))})}return d},a.getExperimentAudiences=function(b,c){return b.audienceConditions?a.getSerializedAudiences(b.audienceConditions,c.audiencesById):""},a.mergeFeatureVariables=function(a,b,c,d,e){var f=(a[c]||[]).reduce(function(a,b){return a[b.key]={id:b.id,key:b.key,type:b.type,value:b.defaultValue},a},{});return(d||[]).forEach(function(a){var c=b[a.id],d={id:a.id,key:c.key,type:c.type,value:e?a.value:c.defaultValue};f[c.key]=d}),f},a.getVariationsMap=function(b,c,d,e){return b.reduce(function(b,f){var g=a.mergeFeatureVariables(c,d,e,f.variables,f.featureEnabled);return b[f.key]={id:f.id,key:f.key,featureEnabled:f.featureEnabled,variablesMap:g},b},{})},a.getVariableIdMap=function(a){return(a.featureFlags||[]).reduce(function(a,b){return b.variables.forEach(function(b){a[b.id]=b}),a},{})},a.getDeliveryRules=function(b,c,d,e){var f=a.getVariableIdMap(b);return e.map(function(e){return{id:e.id,key:e.key,audiences:a.getExperimentAudiences(e,b),variationsMap:a.getVariationsMap(e.variations,c,f,d)}})},a.getRolloutExperimentIds=function(a){var b=[];return(a||[]).forEach(function(a){a.experiments.forEach(function(a){b.push(a.id)})}),b},a.getExperimentsMapById=function(b,c){var d=a.getVariableIdMap(b),e=this.getRolloutExperimentIds(b.rollouts);return(b.experiments||[]).reduce(function(f,g){if(-1===e.indexOf(g.id)){var h=b.experimentFeatureMap[g.id],i="";h&&h.length>0&&(i=h[0]);var j=a.getVariationsMap(g.variations,c,d,i.toString());f[g.id]={id:g.id,key:g.key,audiences:a.getExperimentAudiences(g,b),variationsMap:j}}return f},{})},a.getExperimentsKeyMap=function(a){var b={};for(var c in a){var d=a[c];b[d.key]=d}return b},a.getFeaturesMap=function(b,c,d){var e={};return b.featureFlags.forEach(function(f){var g={},h=[];f.experimentIds.forEach(function(a){var b=d[a];b&&(g[b.key]=b),h.push(d[a])});var i=(f.variables||[]).reduce(function(a,b){return a[b.key]={id:b.id,key:b.key,type:b.type,value:b.defaultValue},a},{}),j=[],k=b.rolloutIdMap[f.rolloutId];k&&(j=a.getDeliveryRules(b,c,f.id,k.experiments)),e[f.key]={id:f.id,key:f.key,experimentRules:h,deliveryRules:j,experimentsMap:g,variablesMap:i}}),e},a}(),O={assign:function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(!a)return{};if("function"==typeof Object.assign)return Object.assign.apply(Object,m([a],b));for(var d=Object(a),e=0;e<b.length;e++){var f=b[e];if(null!=f)for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(d[g]=f[g])}return d},currentTimestamp:function(){return Math.round((new Date).getTime())},isSafeInteger:function(a){return"number"==typeof a&&9007199254740992>=Math.abs(a)},keyBy:function(a,b){return a?(0,h.keyBy)(a,function(a){return a[b]}):{}},uuid:h.generateUUID,isNumber:function(a){return"number"==typeof a}},P="PROJECT_CONFIG",Q=function(a,b){void 0===b&&(b=null);var c,d,e,f,g=(c=a,(f=O.assign({},c)).audiences=(c.audiences||[]).map(function(a){return O.assign({},a)}),f.experiments=(c.experiments||[]).map(function(a){return O.assign({},a)}),f.featureFlags=(c.featureFlags||[]).map(function(a){return O.assign({},a)}),f.groups=(c.groups||[]).map(function(a){var b=O.assign({},a);return b.experiments=(a.experiments||[]).map(function(a){return O.assign({},a)}),b}),f.rollouts=(c.rollouts||[]).map(function(a){var b=O.assign({},a);return b.experiments=(a.experiments||[]).map(function(a){return O.assign({},a)}),b}),f.environmentKey=null!==(d=c.environmentKey)&& void 0!==d?d:"",f.sdkKey=null!==(e=c.sdkKey)&& void 0!==e?e:"",f);return g.__datafileStr=null===b?JSON.stringify(a):b,(g.audiences||[]).forEach(function(a){a.conditions=JSON.parse(a.conditions)}),g.audiencesById=O.keyBy(g.audiences,"id"),O.assign(g.audiencesById,O.keyBy(g.typedAudiences,"id")),g.attributeKeyMap=O.keyBy(g.attributes,"key"),g.eventKeyMap=O.keyBy(g.events,"key"),g.groupIdMap=O.keyBy(g.groups,"id"),Object.keys(g.groupIdMap||{}).forEach(function(a){(g.groupIdMap[a].experiments||[]).forEach(function(b){g.experiments.push(O.assign(b,{groupId:a}))})}),g.rolloutIdMap=O.keyBy(g.rollouts||[],"id"),(0,h.objectValues)(g.rolloutIdMap||{}).forEach(function(a){(a.experiments||[]).forEach(function(a){g.experiments.push(a),a.variationKeyMap=O.keyBy(a.variations,"key")})}),g.experimentKeyMap=O.keyBy(g.experiments,"key"),g.experimentIdMap=O.keyBy(g.experiments,"id"),g.variationIdMap={},g.variationVariableUsageMap={},(g.experiments||[]).forEach(function(a){a.variationKeyMap=O.keyBy(a.variations,"key"),O.assign(g.variationIdMap,O.keyBy(a.variations,"id")),(0,h.objectValues)(a.variationKeyMap||{}).forEach(function(a){a.variables&&(g.variationVariableUsageMap[a.id]=O.keyBy(a.variables,"id"))})}),g.experimentFeatureMap={},g.featureKeyMap=O.keyBy(g.featureFlags||[],"key"),(0,h.objectValues)(g.featureKeyMap||{}).forEach(function(a){a.variables.forEach(function(a){a.type===v.STRING&&a.subType===v.JSON&&(a.type=v.JSON,delete a.subType)}),a.variableKeyMap=O.keyBy(a.variables,"key"),(a.experimentIds||[]).forEach(function(b){g.experimentFeatureMap[b]?g.experimentFeatureMap[b].push(a.id):g.experimentFeatureMap[b]=[a.id]})}),g.flagRulesMap={},(g.featureFlags||[]).forEach(function(a){var b=[];a.experimentIds.forEach(function(a){var c=g.experimentIdMap[a];c&&b.push(c)});var c=g.rolloutIdMap[a.rolloutId];c&&b.push.apply(b,c.experiments),g.flagRulesMap[a.key]=b}),g.flagVariationsMap={},(0,h.objectEntries)(g.flagRulesMap||{}).forEach(function(a){var b=a[0],c=a[1],d=[];c.forEach(function(a){a.variations.forEach(function(a){(0,h.find)(d,function(b){return b.id===a.id})||d.push(a)})}),g.flagVariationsMap[b]=d}),g},R=function(a,b){var c=a.experimentIdMap[b];if(!c)throw Error((0,h.sprintf)(o.INVALID_EXPERIMENT_ID,P,b));return c.layerId},S=function(a,b,c){var d=a.attributeKeyMap[b],e=0===b.indexOf("$opt_");return d?(e&&c.log(n.WARNING,"Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",b,"$opt_"),d.id):e?b:(c.log(n.DEBUG,o.UNRECOGNIZED_ATTRIBUTE,P,b),null)},T=function(a,b){var c=a.eventKeyMap[b];return c?c.id:null},U=function(a,b){var c=a.experimentKeyMap[b];if(!c)throw Error((0,h.sprintf)(o.INVALID_EXPERIMENT_KEY,P,b));return c.status},V=function(a,b){return a.variationIdMap.hasOwnProperty(b)?a.variationIdMap[b].key:null},W=function(a,b){if(a.experimentKeyMap.hasOwnProperty(b)){var c=a.experimentKeyMap[b];if(c)return c}throw Error((0,h.sprintf)(o.EXPERIMENT_KEY_NOT_IN_DATAFILE,P,b))},X=function(a,b){var c=a.experimentIdMap[b];if(!c)throw Error((0,h.sprintf)(o.INVALID_EXPERIMENT_ID,P,b));return c.trafficAllocation},Y=function(a,b,c){if(a.experimentIdMap.hasOwnProperty(b)){var d=a.experimentIdMap[b];if(d)return d}return c.log(n.ERROR,o.INVALID_EXPERIMENT_ID,P,b),null},Z=function(a,b,c){if(!a)return null;var d=a.flagVariationsMap[b];return(0,h.find)(d,function(a){return a.key===c})||null},$=function(a,b,c){if(a.featureKeyMap.hasOwnProperty(b)){var d=a.featureKeyMap[b];if(d)return d}return c.log(n.ERROR,o.FEATURE_NOT_IN_DATAFILE,P,b),null},_=function(a){return a.__datafileStr},aa=function(a){try{d=C(a.datafile)}catch(b){return{configObj:null,error:b}}if(a.jsonSchemaValidator)try{a.jsonSchemaValidator.validate(d),a.logger.log(n.INFO,p.VALID_DATAFILE,P)}catch(c){return{configObj:null,error:c}}else a.logger.log(n.INFO,p.SKIPPING_JSON_VALIDATION,P);var d,e=[d];return"string"==typeof a.datafile&&e.push(a.datafile),{configObj:Q.apply(void 0,e),error:null}},ab=function(a){return!!a.sendFlagDecisions},ac=(0,f.getLogger)();function ad(a,b){return a instanceof Error?a.message:b||"Unknown error"}var ae=function(){function a(a){this.updateListeners=[],this.configObj=null,this.optimizelyConfigObj=null,this.datafileManager=null;try{if(this.jsonSchemaValidator=a.jsonSchemaValidator,!a.datafile&&!a.sdkKey){var b=Error((0,h.sprintf)(o.DATAFILE_AND_SDK_KEY_MISSING,"PROJECT_CONFIG_MANAGER"));return this.readyPromise=Promise.resolve({success:!1,reason:ad(b)}),void ac.error(b)}var c=null;a.datafile&&(c=this.handleNewDatafile(a.datafile)),a.sdkKey&&a.datafileManager?(this.datafileManager=a.datafileManager,this.datafileManager.start(),this.readyPromise=this.datafileManager.onReady().then(this.onDatafileManagerReadyFulfill.bind(this),this.onDatafileManagerReadyReject.bind(this)),this.datafileManager.on("update",this.onDatafileManagerUpdate.bind(this))):this.configObj?this.readyPromise=Promise.resolve({success:!0}):this.readyPromise=Promise.resolve({success:!1,reason:ad(c,"Invalid datafile")})}catch(d){ac.error(d),this.readyPromise=Promise.resolve({success:!1,reason:ad(d,"Error in initialize")})}}return a.prototype.onDatafileManagerReadyFulfill=function(){if(this.datafileManager){var a=this.handleNewDatafile(this.datafileManager.get());return a?{success:!1,reason:ad(a)}:{success:!0}}return{success:!1,reason:ad(null,"Datafile manager is not provided")}},a.prototype.onDatafileManagerReadyReject=function(a){return{success:!1,reason:ad(a,"Failed to become ready")}},a.prototype.onDatafileManagerUpdate=function(){this.datafileManager&&this.handleNewDatafile(this.datafileManager.get())},a.prototype.handleNewDatafile=function(a){var b=aa({datafile:a,jsonSchemaValidator:this.jsonSchemaValidator,logger:ac}),c=b.configObj,d=b.error;if(d)ac.error(d);else{var e=this.configObj?this.configObj.revision:"null";c&&e!==c.revision&&(this.configObj=c,this.optimizelyConfigObj=null,this.updateListeners.forEach(function(a){return a(c)}))}return d},a.prototype.getConfig=function(){return this.configObj},a.prototype.getOptimizelyConfig=function(){var a,b;return!this.optimizelyConfigObj&&this.configObj&&(this.optimizelyConfigObj=(a=this.configObj,b=_(this.configObj),new N(a,b))),this.optimizelyConfigObj},a.prototype.onReady=function(){return this.readyPromise},a.prototype.onUpdate=function(a){var b=this;return this.updateListeners.push(a),function(){var c=b.updateListeners.indexOf(a);c> -1&&b.updateListeners.splice(c,1)}},a.prototype.stop=function(){this.datafileManager&&this.datafileManager.stop(),this.updateListeners=[]},a}(),af=function(a){var b=[],c=a.experimentIdMap[a.experimentId].groupId;if(c){var d=a.groupIdMap[c];if(!d)throw Error((0,h.sprintf)(o.INVALID_GROUP_ID,"BUCKETER",c));if("random"===d.policy){var e=ag(d,a.bucketingId,a.userId,a.logger);if(null===e)return a.logger.log(n.INFO,p.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",a.userId,c),b.push([p.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",a.userId,c]),{result:null,reasons:b};if(e!==a.experimentId)return a.logger.log(n.INFO,p.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",a.userId,a.experimentKey,c),b.push([p.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",a.userId,a.experimentKey,c]),{result:null,reasons:b};a.logger.log(n.INFO,p.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",a.userId,a.experimentKey,c),b.push([p.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",a.userId,a.experimentKey,c])}}var f=ai(""+a.bucketingId+a.experimentId);a.logger.log(n.DEBUG,p.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",f,a.userId),b.push([p.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",f,a.userId]);var g=ah(f,a.trafficAllocationConfig);return null===g||a.variationIdMap[g]?{result:g,reasons:b}:(g&&(a.logger.log(n.WARNING,p.INVALID_VARIATION_ID,"BUCKETER"),b.push([p.INVALID_VARIATION_ID,"BUCKETER"])),{result:null,reasons:b})},ag=function(a,b,c,d){var e=ai(""+b+a.id);return d.log(n.DEBUG,p.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",e,c),ah(e,a.trafficAllocation)},ah=function(a,b){for(var c=0;c<b.length;c++)if(a<b[c].endOfRange)return b[c].entityId;return null},ai=function(a){try{var b=j().v3(a,1)/4294967296;return Math.floor(1e4*b)}catch(c){throw Error((0,h.sprintf)(o.INVALID_BUCKETING_ID,"BUCKETER",a,c.message))}},aj=(0,f.getLogger)();function ak(a){return/^\d+$/.test(a)}function al(a){var b=a.indexOf("-"),c=a.indexOf("+");return!(b<0)&&(c<0||b<c)}function am(a){var b=a.indexOf("-"),c=a.indexOf("+");return!(c<0)&&(b<0||c<b)}function an(a){var b,c=a,d="";if(b=a,/\s/.test(b))return aj.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",a),null;if(al(a)?(c=a.substring(0,a.indexOf("-")),d=a.substring(a.indexOf("-")+1)):am(a)&&(c=a.substring(0,a.indexOf("+")),d=a.substring(a.indexOf("+")+1)),"string"!=typeof c||"string"!=typeof d)return null;var e=c.split(".").length-1;if(e>2)return aj.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",a),null;var f=c.split(".");if(f.length!=e+1)return aj.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",a),null;for(var g=0,h=f;g<h.length;g++)if(!ak(h[g]))return aj.warn(p.UNKNOWN_MATCH_TYPE,"SEMANTIC VERSION",a),null;return d&&f.push(d),f}var ao="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",ap=(0,f.getLogger)(),aq=["exact","exists","gt","ge","lt","le","substring","semver_eq","semver_lt","semver_le","semver_gt","semver_ge"],ar={};function as(a){return"string"==typeof a||"boolean"==typeof a||O.isNumber(a)}function at(a,b){var c=a.value,d=a.name,e=b[d],f=typeof e;return!as(c)||O.isNumber(c)&&!O.isSafeInteger(c)?(ap.warn(p.UNEXPECTED_CONDITION_VALUE,ao,JSON.stringify(a)),null):null===e?(ap.debug(p.UNEXPECTED_TYPE_NULL,ao,JSON.stringify(a),d),null):as(e)&& typeof c===f?O.isNumber(e)&&!O.isSafeInteger(e)?(ap.warn(p.OUT_OF_BOUNDS,ao,JSON.stringify(a),d),null):c===e:(ap.warn(p.UNEXPECTED_TYPE,ao,JSON.stringify(a),f,d),null)}function au(a,b){var c=a.name,d=b[c],e=a.value;return null!==e&&O.isSafeInteger(e)?null===d?(ap.debug(p.UNEXPECTED_TYPE_NULL,ao,JSON.stringify(a),c),!1):O.isNumber(d)?!!O.isSafeInteger(d)||(ap.warn(p.OUT_OF_BOUNDS,ao,JSON.stringify(a),c),!1):(ap.warn(p.UNEXPECTED_TYPE,ao,JSON.stringify(a),typeof d,c),!1):(ap.warn(p.UNEXPECTED_CONDITION_VALUE,ao,JSON.stringify(a)),!1)}function av(a,b){var c=a.name,d=b[c],e=a.value;return"string"!=typeof e?(ap.warn(p.UNEXPECTED_CONDITION_VALUE,ao,JSON.stringify(a)),null):null===d?(ap.debug(p.UNEXPECTED_TYPE_NULL,ao,JSON.stringify(a),c),null):"string"!=typeof d?(ap.warn(p.UNEXPECTED_TYPE,ao,JSON.stringify(a),typeof d,c),null):function(a,b){var c=an(b),d=an(a);if(!c||!d)return null;for(var e=c.length,f=0;f<d.length;f++){if(e<=f)return al(a)||am(a)?1:-1;if(ak(c[f])){var g=parseInt(c[f]),h=parseInt(d[f]);if(g>h)return 1;if(g<h)return -1}else{if(c[f]<d[f])return al(a)&&!al(b)?1:-1;if(c[f]>d[f])return!al(a)&&al(b)?-1:1}}return al(b)&&!al(a)?-1:0}(e,d)}ar.exact=at,ar.exists=function(a,b){return null!=b[a.name]},ar.gt=function(a,b){var c=b[a.name],d=a.value;return au(a,b)&&null!==d?c>d:null},ar.ge=function(a,b){var c=b[a.name],d=a.value;return au(a,b)&&null!==d?c>=d:null},ar.lt=function(a,b){var c=b[a.name],d=a.value;return au(a,b)&&null!==d?c<d:null},ar.le=function(a,b){var c=b[a.name],d=a.value;return au(a,b)&&null!==d?c<=d:null},ar.substring=function(a,b){var c=a.name,d=b[a.name],e=a.value;return"string"!=typeof e?(ap.warn(p.UNEXPECTED_CONDITION_VALUE,ao,JSON.stringify(a)),null):null===d?(ap.debug(p.UNEXPECTED_TYPE_NULL,ao,JSON.stringify(a),c),null):"string"!=typeof d?(ap.warn(p.UNEXPECTED_TYPE,ao,JSON.stringify(a),typeof d,c),null):-1!==d.indexOf(e)},ar.semver_eq=function(a,b){var c=av(a,b);return null===c?null:0===c},ar.semver_gt=function(a,b){var c=av(a,b);return null===c?null:c>0},ar.semver_ge=function(a,b){var c=av(a,b);return null===c?null:c>=0},ar.semver_lt=function(a,b){var c=av(a,b);return null===c?null:c<0},ar.semver_le=function(a,b){var c=av(a,b);return null===c?null:c<=0};var aw=Object.freeze({__proto__:null,evaluate:function(a,b){var c=a.match;if(void 0!==c&& -1===aq.indexOf(c))return ap.warn(p.UNKNOWN_MATCH_TYPE,ao,JSON.stringify(a)),null;var d=a.name;return b.hasOwnProperty(d)||"exists"==c?(c&&ar[c]||at)(a,b):(ap.debug(p.MISSING_ATTRIBUTE_VALUE,ao,JSON.stringify(a),d),null)}}),ax=(0,f.getLogger)(),ay=function(){function a(a){this.typeToEvaluatorMap=O.assign({},a,{custom_attribute:aw})}return a.prototype.evaluate=function(a,b,c){var d=this;return void 0===c&&(c={}),!a||0===a.length||!!M(a,function(a){var e=b[a];if(e){ax.log(n.DEBUG,p.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",a,JSON.stringify(e.conditions));var f=M(e.conditions,d.evaluateConditionWithUserAttributes.bind(d,c)),g=null===f?"UNKNOWN":f.toString().toUpperCase();return ax.log(n.DEBUG,p.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",a,g),f}return null})},a.prototype.evaluateConditionWithUserAttributes=function(a,b){var c=this.typeToEvaluatorMap[b.type];if(!c)return ax.log(n.WARNING,p.UNKNOWN_CONDITION_TYPE,"AUDIENCE_EVALUATOR",JSON.stringify(b)),null;try{return c.evaluate(b,a)}catch(d){ax.log(n.ERROR,o.CONDITION_EVALUATOR_ERROR,"AUDIENCE_EVALUATOR",b.type,d.message)}return null},a}();function az(a){return"string"==typeof a&&""!==a}var aA="DECISION_SERVICE",aB=function(){function a(a){var b;this.audienceEvaluator=(b=a.UNSTABLE_conditionEvaluators,new ay(b)),this.forcedVariationMap={},this.logger=a.logger,this.userProfileService=a.userProfileService||null}return a.prototype.getVariation=function(a,b,c,d){void 0===d&&(d={});var e=c.getUserId(),f=c.getAttributes(),g=this.getBucketingId(e,f),h=[],i=b.key;if(!this.checkIfExperimentIsActive(a,i))return this.logger.log(n.INFO,p.EXPERIMENT_NOT_RUNNING,aA,i),h.push([p.EXPERIMENT_NOT_RUNNING,aA,i]),{result:null,reasons:h};var j=this.getForcedVariation(a,i,e);h.push.apply(h,j.reasons);var k=j.result;if(k)return{result:k,reasons:h};var l=this.getWhitelistedVariation(b,e);h.push.apply(h,l.reasons);var m=l.result;if(m)return{result:m.key,reasons:h};var o=d[H.IGNORE_USER_PROFILE_SERVICE],q=this.resolveExperimentBucketMap(e,f);if(!o&&(m=this.getStoredVariation(a,b,e,q)))return this.logger.log(n.INFO,p.RETURNING_STORED_VARIATION,aA,m.key,i,e),h.push([p.RETURNING_STORED_VARIATION,aA,m.key,i,e]),{result:m.key,reasons:h};var r=this.checkIfUserIsInAudience(a,b,u.EXPERIMENT,f,"");if(h.push.apply(h,r.reasons),!r.result)return this.logger.log(n.INFO,p.USER_NOT_IN_EXPERIMENT,aA,e,i),h.push([p.USER_NOT_IN_EXPERIMENT,aA,e,i]),{result:null,reasons:h};var s=this.buildBucketerParams(a,b,g,e),t=af(s);h.push.apply(h,t.reasons);var v=t.result;return v&&(m=a.variationIdMap[v]),m?(this.logger.log(n.INFO,p.USER_HAS_VARIATION,aA,e,m.key,i),h.push([p.USER_HAS_VARIATION,aA,e,m.key,i]),o||this.saveUserProfile(b,m,e,q),{result:m.key,reasons:h}):(this.logger.log(n.DEBUG,p.USER_HAS_NO_VARIATION,aA,e,i),h.push([p.USER_HAS_NO_VARIATION,aA,e,i]),{result:null,reasons:h})},a.prototype.resolveExperimentBucketMap=function(a,b){b=b||{};var c=this.getUserProfile(a)||{},d=b[q.STICKY_BUCKETING_KEY];return O.assign({},c.experiment_bucket_map,d)},a.prototype.checkIfExperimentIsActive=function(a,b){var c,d;return c=a,"Running"===U(c,d=b)},a.prototype.getWhitelistedVariation=function(a,b){var c=[];if(a.forcedVariations&&a.forcedVariations.hasOwnProperty(b)){var d=a.forcedVariations[b];return a.variationKeyMap.hasOwnProperty(d)?(this.logger.log(n.INFO,p.USER_FORCED_IN_VARIATION,aA,b,d),c.push([p.USER_FORCED_IN_VARIATION,aA,b,d]),{result:a.variationKeyMap[d],reasons:c}):(this.logger.log(n.ERROR,p.FORCED_BUCKETING_FAILED,aA,d,b),c.push([p.FORCED_BUCKETING_FAILED,aA,d,b]),{result:null,reasons:c})}return{result:null,reasons:c}},a.prototype.checkIfUserIsInAudience=function(a,b,c,d,e){var f=[],g=function(a,b){var c=a.experimentIdMap[b];if(!c)throw Error((0,h.sprintf)(o.INVALID_EXPERIMENT_ID,P,b));return c.audienceConditions||c.audienceIds}(a,b.id),i=a.audiencesById;this.logger.log(n.DEBUG,p.EVALUATING_AUDIENCES_COMBINED,aA,c,e||b.key,JSON.stringify(g)),f.push([p.EVALUATING_AUDIENCES_COMBINED,aA,c,e||b.key,JSON.stringify(g)]);var j=this.audienceEvaluator.evaluate(g,i,d);return this.logger.log(n.INFO,p.AUDIENCE_EVALUATION_RESULT_COMBINED,aA,c,e||b.key,j.toString().toUpperCase()),f.push([p.AUDIENCE_EVALUATION_RESULT_COMBINED,aA,c,e||b.key,j.toString().toUpperCase()]),{result:j,reasons:f}},a.prototype.buildBucketerParams=function(a,b,c,d){return{bucketingId:c,experimentId:b.id,experimentKey:b.key,experimentIdMap:a.experimentIdMap,experimentKeyMap:a.experimentKeyMap,groupIdMap:a.groupIdMap,logger:this.logger,trafficAllocationConfig:X(a,b.id),userId:d,variationIdMap:a.variationIdMap}},a.prototype.getStoredVariation=function(a,b,c,d){if(d.hasOwnProperty(b.id)){var e=d[b.id],f=e.variation_id;if(a.variationIdMap.hasOwnProperty(f))return a.variationIdMap[e.variation_id];this.logger.log(n.INFO,p.SAVED_VARIATION_NOT_FOUND,aA,c,f,b.key)}return null},a.prototype.getUserProfile=function(a){if(!this.userProfileService)return{user_id:a,experiment_bucket_map:{}};try{return this.userProfileService.lookup(a)}catch(b){this.logger.log(n.ERROR,o.USER_PROFILE_LOOKUP_ERROR,aA,a,b.message)}return null},a.prototype.saveUserProfile=function(a,b,c,d){if(this.userProfileService)try{d[a.id]={variation_id:b.id},this.userProfileService.save({user_id:c,experiment_bucket_map:d}),this.logger.log(n.INFO,p.SAVED_VARIATION,aA,b.key,a.key,c)}catch(e){this.logger.log(n.ERROR,o.USER_PROFILE_SAVE_ERROR,aA,c,e.message)}},a.prototype.getVariationForFeature=function(a,b,c,d){void 0===d&&(d={});var e=[],f=this.getVariationForFeatureExperiment(a,b,c,d);e.push.apply(e,f.reasons);var g=f.result;if(null!==g.variation)return{result:g,reasons:e};var h=this.getVariationForRollout(a,b,c);e.push.apply(e,h.reasons);var i=h.result,j=c.getUserId();return i.variation?(this.logger.log(n.DEBUG,p.USER_IN_ROLLOUT,aA,j,b.key),e.push([p.USER_IN_ROLLOUT,aA,j,b.key]),{result:i,reasons:e}):(this.logger.log(n.DEBUG,p.USER_NOT_IN_ROLLOUT,aA,j,b.key),e.push([p.USER_NOT_IN_ROLLOUT,aA,j,b.key]),{result:i,reasons:e})},a.prototype.getVariationForFeatureExperiment=function(a,b,c,d){void 0===d&&(d={});var e,f,g=[],h=null;if(b.experimentIds.length>0)for(f=0;f<b.experimentIds.length;f++){var i=Y(a,b.experimentIds[f],this.logger);if(i&&(e=this.getVariationFromExperimentRule(a,b.key,i,c,d),g.push.apply(g,e.reasons),h=e.result)){var j=null;return(j=i.variationKeyMap[h])||(j=Z(a,b.key,h)),{result:{experiment:i,variation:j,decisionSource:t.FEATURE_TEST},reasons:g}}}else this.logger.log(n.DEBUG,p.FEATURE_HAS_NO_EXPERIMENTS,aA,b.key),g.push([p.FEATURE_HAS_NO_EXPERIMENTS,aA,b.key]);return{result:{experiment:null,variation:null,decisionSource:t.FEATURE_TEST},reasons:g}},a.prototype.getVariationForRollout=function(a,b,c){var d=[];if(!b.rolloutId)return this.logger.log(n.DEBUG,p.NO_ROLLOUT_EXISTS,aA,b.key),d.push([p.NO_ROLLOUT_EXISTS,aA,b.key]),{result:{experiment:null,variation:null,decisionSource:t.ROLLOUT},reasons:d};var e=a.rolloutIdMap[b.rolloutId];if(!e)return this.logger.log(n.ERROR,o.INVALID_ROLLOUT_ID,aA,b.rolloutId,b.key),d.push([o.INVALID_ROLLOUT_ID,aA,b.rolloutId,b.key]),{result:{experiment:null,variation:null,decisionSource:t.ROLLOUT},reasons:d};var f,g,h,i=e.experiments;if(0===i.length)return this.logger.log(n.ERROR,p.ROLLOUT_HAS_NO_EXPERIMENTS,aA,b.rolloutId),d.push([p.ROLLOUT_HAS_NO_EXPERIMENTS,aA,b.rolloutId]),{result:{experiment:null,variation:null,decisionSource:t.ROLLOUT},reasons:d};for(var j=0;j<i.length;){if(f=this.getVariationFromDeliveryRule(a,b.key,i,j,c),d.push.apply(d,f.reasons),h=f.result,g=f.skipToEveryoneElse,h)return{result:{experiment:a.experimentIdMap[i[j].id],variation:h,decisionSource:t.ROLLOUT},reasons:d};j=g?i.length-1:j+1}return{result:{experiment:null,variation:null,decisionSource:t.ROLLOUT},reasons:d}},a.prototype.getBucketingId=function(a,b){var c=a;return null!=b&&"object"==typeof b&&b.hasOwnProperty(q.BUCKETING_ID)&&("string"==typeof b[q.BUCKETING_ID]?(c=b[q.BUCKETING_ID],this.logger.log(n.DEBUG,p.VALID_BUCKETING_ID,aA,c)):this.logger.log(n.WARNING,p.BUCKETING_ID_NOT_STRING,aA)),c},a.prototype.findValidatedForcedDecision=function(a,b,c,d){var e,f=[],g=b.getForcedDecision({flagKey:c,ruleKey:d}),h=null,i=b.getUserId();return a&&g&&((h=Z(a,c,e=g.variationKey))?d?(this.logger.log(n.INFO,p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,e,c,d,i),f.push([p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED,e,c,d,i])):(this.logger.log(n.INFO,p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,e,c,i),f.push([p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED,e,c,i])):d?(this.logger.log(n.INFO,p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,c,d,i),f.push([p.USER_HAS_FORCED_DECISION_WITH_RULE_SPECIFIED_BUT_INVALID,c,d,i])):(this.logger.log(n.INFO,p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,c,i),f.push([p.USER_HAS_FORCED_DECISION_WITH_NO_RULE_SPECIFIED_BUT_INVALID,c,i]))),{result:h,reasons:f}},a.prototype.removeForcedVariation=function(a,b,c){if(!a)throw Error((0,h.sprintf)(o.INVALID_USER_ID,aA));if(!this.forcedVariationMap.hasOwnProperty(a))throw Error((0,h.sprintf)(o.USER_NOT_IN_FORCED_VARIATION,aA,a));delete this.forcedVariationMap[a][b],this.logger.log(n.DEBUG,p.VARIATION_REMOVED_FOR_USER,aA,c,a)},a.prototype.setInForcedVariationMap=function(a,b,c){this.forcedVariationMap.hasOwnProperty(a)||(this.forcedVariationMap[a]={}),this.forcedVariationMap[a][b]=c,this.logger.log(n.DEBUG,p.USER_MAPPED_TO_FORCED_VARIATION,aA,c,b,a)},a.prototype.getForcedVariation=function(a,b,c){var d,e=[],f=this.forcedVariationMap[c];if(!f)return this.logger.log(n.DEBUG,p.USER_HAS_NO_FORCED_VARIATION,aA,c),{result:null,reasons:e};try{var g=W(a,b);if(!g.hasOwnProperty("id"))return this.logger.log(n.ERROR,o.IMPROPERLY_FORMATTED_EXPERIMENT,aA,b),e.push([o.IMPROPERLY_FORMATTED_EXPERIMENT,aA,b]),{result:null,reasons:e};d=g.id}catch(h){return this.logger.log(n.ERROR,h.message),e.push(h.message),{result:null,reasons:e}}var i=f[d];if(!i)return this.logger.log(n.DEBUG,p.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,aA,b,c),{result:null,reasons:e};var j=V(a,i);return j?(this.logger.log(n.DEBUG,p.USER_HAS_FORCED_VARIATION,aA,j,b,c),e.push([p.USER_HAS_FORCED_VARIATION,aA,j,b,c])):this.logger.log(n.DEBUG,p.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,aA,b,c),{result:j,reasons:e}},a.prototype.setForcedVariation=function(a,b,c,d){if(null!=d&&!az(d))return this.logger.log(n.ERROR,o.INVALID_VARIATION_KEY,aA),!1;try{var e,f=W(a,b);if(!f.hasOwnProperty("id"))return this.logger.log(n.ERROR,o.IMPROPERLY_FORMATTED_EXPERIMENT,aA,b),!1;e=f.id}catch(g){return this.logger.log(n.ERROR,g.message),!1}if(null==d)try{return this.removeForcedVariation(c,e,b),!0}catch(h){return this.logger.log(n.ERROR,h.message),!1}var i,j,k,l,m=(i=a,j=b,k=d,(l=i.experimentKeyMap[j]).variationKeyMap.hasOwnProperty(k)?l.variationKeyMap[k].id:null);if(!m)return this.logger.log(n.ERROR,o.NO_VARIATION_FOR_EXPERIMENT_KEY,aA,d,b),!1;try{return this.setInForcedVariationMap(c,e,m),!0}catch(p){return this.logger.log(n.ERROR,p.message),!1}},a.prototype.getVariationFromExperimentRule=function(a,b,c,d,e){void 0===e&&(e={});var f=[],g=this.findValidatedForcedDecision(a,d,b,c.key);f.push.apply(f,g.reasons);var h=g.result;if(h)return{result:h.key,reasons:f};var i=this.getVariation(a,c,d,e);return f.push.apply(f,i.reasons),{result:i.result,reasons:f}},a.prototype.getVariationFromDeliveryRule=function(a,b,c,d,e){var f=[],g=!1,h=c[d],i=this.findValidatedForcedDecision(a,e,b,h.key);f.push.apply(f,i.reasons);var j=i.result;if(j)return{result:j,reasons:f,skipToEveryoneElse:g};var k,l,m,o,q,r=e.getUserId(),s=e.getAttributes(),t=this.getBucketingId(r,s),v=d===c.length-1,w=v?"Everyone Else":d+1,x=null,y=this.checkIfUserIsInAudience(a,h,u.RULE,s,w);return f.push.apply(f,y.reasons),y.result?(this.logger.log(n.DEBUG,p.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,aA,r,w),f.push([p.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,aA,r,w]),l=this.buildBucketerParams(a,h,t,r),m=af(l),f.push.apply(f,m.reasons),(k=m.result)&&(q=k,x=(o=a).variationIdMap.hasOwnProperty(q)?o.variationIdMap[q]:null),x?(this.logger.log(n.DEBUG,p.USER_BUCKETED_INTO_TARGETING_RULE,aA,r,w),f.push([p.USER_BUCKETED_INTO_TARGETING_RULE,aA,r,w])):v||(this.logger.log(n.DEBUG,p.USER_NOT_BUCKETED_INTO_TARGETING_RULE,aA,r,w),f.push([p.USER_NOT_BUCKETED_INTO_TARGETING_RULE,aA,r,w]),g=!0)):(this.logger.log(n.DEBUG,p.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,aA,r,w),f.push([p.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,aA,r,w])),{result:x,reasons:f,skipToEveryoneElse:g}},a}();function aC(a,b){if(a.hasOwnProperty("revenue")){var c=a.revenue,d=void 0;return"string"==typeof c?(d=parseInt(c),isNaN(d)?(b.log(n.INFO,p.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",c),null):(b.log(n.INFO,p.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",d),d)):"number"==typeof c?(d=c,b.log(n.INFO,p.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",d),d):null}return null}function aD(a,b){if(a.hasOwnProperty("value")){var c=a.value,d=void 0;return"string"==typeof c?(d=parseFloat(c),isNaN(d)?(b.log(n.INFO,p.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",c),null):(b.log(n.INFO,p.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",d),d)):"number"==typeof c?(d=c,b.log(n.INFO,p.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",d),d):null}return null}function aE(a,b){return"string"==typeof a&&("string"==typeof b||"boolean"==typeof b||O.isNumber(b)&&O.isSafeInteger(b))}var aF="https://logx.optimizely.com/v1/events";function aG(a){var b=a.attributes,c=a.userId,d=a.clientEngine,e=a.clientVersion,f=a.configObj,g=a.logger,h=!!f.anonymizeIP&&f.anonymizeIP,i=f.botFiltering,j={account_id:f.accountId,project_id:f.projectId,visitors:[{snapshots:[],visitor_id:c,attributes:[]}],revision:f.revision,client_name:d,client_version:e,anonymize_ip:h,enrich_decisions:!0};return b&&Object.keys(b||{}).forEach(function(a){if(aE(a,b[a])){var c=S(f,a,g);c&&j.visitors[0].attributes.push({entity_id:c,key:a,type:"custom",value:b[a]})}}),"boolean"==typeof i&&j.visitors[0].attributes.push({entity_id:q.BOT_FILTERING,key:q.BOT_FILTERING,type:"custom",value:i}),j}function aH(a){var b,c;return null!==(c=null===(b=a.experiment)|| void 0===b?void 0:b.key)&& void 0!==c?c:""}function aI(a){var b,c;return null!==(c=null===(b=a.variation)|| void 0===b?void 0:b.key)&& void 0!==c?c:""}function aJ(a){var b,c;return null!==(c=null===(b=a.variation)|| void 0===b?void 0:b.featureEnabled)&& void 0!==c&&c}function aK(a){var b,c;return null!==(c=null===(b=a.experiment)|| void 0===b?void 0:b.id)&& void 0!==c?c:null}function aL(a){var b,c;return null!==(c=null===(b=a.variation)|| void 0===b?void 0:b.id)&& void 0!==c?c:null}var aM=(0,f.getLogger)("EVENT_BUILDER");function aN(a,b){var c=[];return b&&Object.keys(b||{}).forEach(function(d){if(aE(d,b[d])){var e=S(a,d,aM);e&&c.push({entityId:e,key:d,value:b[d]})}}),c}var aO="USER_PROFILE_SERVICE_VALIDATOR",aP=function(){function a(a){var b,c=this,d=a.clientEngine;d||(a.logger.log(n.INFO,p.INVALID_CLIENT_ENGINE,"OPTIMIZELY",d),d="node-sdk"),this.clientEngine=d,this.clientVersion=a.clientVersion||"4.9.1",this.errorHandler=a.errorHandler,this.isOptimizelyConfigValid=a.isValidInstance,this.logger=a.logger;var e=null!==(b=a.defaultDecideOptions)&& void 0!==b?b:[];Array.isArray(e)||(this.logger.log(n.DEBUG,p.INVALID_DEFAULT_DECIDE_OPTIONS,"OPTIMIZELY"),e=[]);var f,g={};e.forEach(function(a){H[a]?g[a]=!0:c.logger.log(n.WARNING,p.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",a)}),this.defaultDecideOptions=g,this.projectConfigManager=(f={datafile:a.datafile,jsonSchemaValidator:a.jsonSchemaValidator,sdkKey:a.sdkKey,datafileManager:a.datafileManager},new ae(f)),this.disposeOnUpdate=this.projectConfigManager.onUpdate(function(a){c.logger.log(n.INFO,p.UPDATED_OPTIMIZELY_CONFIG,"OPTIMIZELY",a.revision,a.projectId),c.notificationCenter.sendNotifications(r.OPTIMIZELY_CONFIG_UPDATE)});var i,j=this.projectConfigManager.onReady(),k=null;if(a.userProfileService)try{(function(a){if("object"==typeof a&&null!==a){if("function"!=typeof a.lookup)throw Error((0,h.sprintf)(o.INVALID_USER_PROFILE_SERVICE,aO,"Missing function 'lookup'"));if("function"!=typeof a.save)throw Error((0,h.sprintf)(o.INVALID_USER_PROFILE_SERVICE,aO,"Missing function 'save'"));return!0}throw Error((0,h.sprintf)(o.INVALID_USER_PROFILE_SERVICE,aO))})(a.userProfileService)&&(k=a.userProfileService,this.logger.log(n.INFO,p.VALID_USER_PROFILE_SERVICE,"OPTIMIZELY"))}catch(l){this.logger.log(n.WARNING,l.message)}this.decisionService=(i={userProfileService:k,logger:this.logger,UNSTABLE_conditionEvaluators:a.UNSTABLE_conditionEvaluators},new aB(i)),this.notificationCenter=a.notificationCenter,this.eventProcessor=a.eventProcessor;var m=this.eventProcessor.start();this.readyPromise=Promise.all([j,m]).then(function(a){return a[0]}),this.readyTimeouts={},this.nextReadyTimeoutId=0}return a.prototype.isValidInstance=function(){return this.isOptimizelyConfigValid&&!!this.projectConfigManager.getConfig()},a.prototype.activate=function(a,b,c){try{if(!this.isValidInstance())return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","activate"),null;if(!this.validateInputs({experiment_key:a,user_id:b},c))return this.notActivatingExperiment(a,b);var d=this.projectConfigManager.getConfig();if(!d)return null;try{var e,f,g=this.getVariation(a,b,c);if(null===g)return this.notActivatingExperiment(a,b);if(e=d,f=a,"Running"!==U(e,f))return this.logger.log(n.DEBUG,p.SHOULD_NOT_DISPATCH_ACTIVATE,"OPTIMIZELY",a),g;var h=W(d,a),i={experiment:h,variation:h.variationKeyMap[g],decisionSource:t.EXPERIMENT};return this.sendImpressionEvent(i,"",b,!0,c),g}catch(j){return this.logger.log(n.ERROR,j.message),this.logger.log(n.INFO,p.NOT_ACTIVATING_USER,"OPTIMIZELY",b,a),this.errorHandler.handleError(j),null}}catch(k){return this.logger.log(n.ERROR,k.message),this.errorHandler.handleError(k),null}},a.prototype.sendImpressionEvent=function(a,b,c,d,e){var f=this.projectConfigManager.getConfig();if(f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=(h=(g={decisionObj:a,flagKey:b,enabled:d,userId:c,userAttributes:e,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:f}).configObj,i=g.decisionObj,j=g.userId,k=g.flagKey,l=g.enabled,m=g.userAttributes,n=g.clientEngine,o=g.clientVersion,p=i.decisionSource,q=aH(i),r=aK(i),s=aI(i),t=aL(i),u=null!==r?R(h,r):null,{type:"impression",timestamp:O.currentTimestamp(),uuid:O.uuid(),user:{id:j,attributes:aN(h,m)},context:{accountId:h.accountId,projectId:h.projectId,revision:h.revision,clientName:n,clientVersion:o,anonymizeIP:h.anonymizeIP||!1,botFiltering:h.botFiltering},layer:{id:u},experiment:{id:r,key:q},variation:{id:t,key:s},ruleKey:q,flagKey:k,ruleType:p,enabled:l});this.eventProcessor.process(v),this.emitNotificationCenterActivate(a,b,c,d,e)}},a.prototype.emitNotificationCenterActivate=function(a,b,c,d,e){var f=this.projectConfigManager.getConfig();if(f){var g,h,i,j,k,l,m,n,o,p,q,s,t,u=a.decisionSource,v=aH(a),w=aK(a),x=aI(a),y=aL(a);null!==w&&""!==x&&(g=f.experimentIdMap[w]);var z,A=(h={attributes:e,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:f,experimentId:w,ruleKey:v,flagKey:b,ruleType:u,userId:c,enabled:d,variationId:y,logger:this.logger},s=aG(h),t=(i=h.configObj,j=h.experimentId,k=h.variationId,l=h.ruleKey,m=h.ruleType,n=h.flagKey,o=h.enabled,p=j?R(i,j):null,q=k?V(i,k):null,{decisions:[{campaign_id:p,experiment_id:j,variation_id:k,metadata:{flag_key:n,rule_key:l,rule_type:m,variation_key:q=q||"",enabled:o}}],events:[{entity_id:p,timestamp:O.currentTimestamp(),key:"campaign_activated",uuid:O.uuid()}]}),s.visitors[0].snapshots.push(t),{httpVerb:"POST",url:aF,params:s});g&&g.variationKeyMap&&""!==x&&(z=g.variationKeyMap[x]),this.notificationCenter.sendNotifications(r.ACTIVATE,{experiment:g,userId:c,attributes:e,variation:z,logEvent:A})}},a.prototype.track=function(a,b,c,d){try{if(!this.isValidInstance())return void this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","track");if(!this.validateInputs({user_id:b,event_key:a},c,d))return;var e=this.projectConfigManager.getConfig();if(!e)return;if(f=e,g=a,!f.eventKeyMap.hasOwnProperty(g))return this.logger.log(n.WARNING,p.EVENT_KEY_NOT_FOUND,"OPTIMIZELY",a),void this.logger.log(n.WARNING,p.NOT_TRACKING_USER,"OPTIMIZELY",b);var f,g,h,i,j,k,l,m,o,q,r,s,t,u=(i=(h={eventKey:a,eventTags:d=this.filterEmptyValues(d),userId:b,userAttributes:c,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:e}).configObj,j=h.userId,k=h.userAttributes,l=h.clientEngine,m=h.clientVersion,o=h.eventKey,q=h.eventTags,r=T(i,o),s=q?aC(q,aM):null,t=q?aD(q,aM):null,{type:"conversion",timestamp:O.currentTimestamp(),uuid:O.uuid(),user:{id:j,attributes:aN(i,k)},context:{accountId:i.accountId,projectId:i.projectId,revision:i.revision,clientName:l,clientVersion:m,anonymizeIP:i.anonymizeIP||!1,botFiltering:i.botFiltering},event:{id:r,key:o},revenue:s,value:t,tags:q});this.logger.log(n.INFO,p.TRACK_EVENT,"OPTIMIZELY",a,b),this.eventProcessor.process(u),this.emitNotificationCenterTrack(a,b,c,d)}catch(v){this.logger.log(n.ERROR,v.message),this.errorHandler.handleError(v),this.logger.log(n.ERROR,p.NOT_TRACKING_USER,"OPTIMIZELY",b)}},a.prototype.emitNotificationCenterTrack=function(a,b,c,d){try{var e=this.projectConfigManager.getConfig();if(!e)return;var f,g,h,i=(f={attributes:c,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:e,eventKey:a,eventTags:d,logger:this.logger,userId:b},g=aG(f),h=function(a,b,c,d){var e={events:[]},f={entity_id:T(a,b),timestamp:O.currentTimestamp(),uuid:O.uuid(),key:b};if(d){var g=aC(d,c);null!==g&&(f.revenue=g);var h=aD(d,c);null!==h&&(f.value=h),f.tags=d}return e.events.push(f),e}(f.configObj,f.eventKey,f.logger,f.eventTags),g.visitors[0].snapshots=[h],{httpVerb:"POST",url:aF,params:g});this.notificationCenter.sendNotifications(r.TRACK,{eventKey:a,userId:b,attributes:c,eventTags:d,logEvent:i})}catch(j){this.logger.log(n.ERROR,j.message),this.errorHandler.handleError(j)}},a.prototype.getVariation=function(a,b,c){try{if(!this.isValidInstance())return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getVariation"),null;try{if(!this.validateInputs({experiment_key:a,user_id:b},c))return null;var d,e,f=this.projectConfigManager.getConfig();if(!f)return null;var g=f.experimentKeyMap[a];if(!g)return this.logger.log(n.DEBUG,o.INVALID_EXPERIMENT_KEY,"OPTIMIZELY",a),null;var h=this.decisionService.getVariation(f,g,this.createUserContext(b,c)).result,i=(d=f,e=g.id,d.experimentFeatureMap.hasOwnProperty(e)?s.FEATURE_TEST:s.AB_TEST);return this.notificationCenter.sendNotifications(r.DECISION,{type:i,userId:b,attributes:c||{},decisionInfo:{experimentKey:a,variationKey:h}}),h}catch(j){return this.logger.log(n.ERROR,j.message),this.errorHandler.handleError(j),null}}catch(k){return this.logger.log(n.ERROR,k.message),this.errorHandler.handleError(k),null}},a.prototype.setForcedVariation=function(a,b,c){if(!this.validateInputs({experiment_key:a,user_id:b}))return!1;var d=this.projectConfigManager.getConfig();if(!d)return!1;try{return this.decisionService.setForcedVariation(d,a,b,c)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),!1}},a.prototype.getForcedVariation=function(a,b){if(!this.validateInputs({experiment_key:a,user_id:b}))return null;var c=this.projectConfigManager.getConfig();if(!c)return null;try{return this.decisionService.getForcedVariation(c,a,b).result}catch(d){return this.logger.log(n.ERROR,d.message),this.errorHandler.handleError(d),null}},a.prototype.validateInputs=function(a,b,c){try{if(a.hasOwnProperty("user_id")){var d=a.user_id;if("string"!=typeof d||null===d||"undefined"===d)throw Error((0,h.sprintf)(o.INVALID_INPUT_FORMAT,"OPTIMIZELY","user_id"));delete a.user_id}return Object.keys(a).forEach(function(b){if(!az(a[b]))throw Error((0,h.sprintf)(o.INVALID_INPUT_FORMAT,"OPTIMIZELY",b))}),b&&function(a){if("object"!=typeof a||Array.isArray(a)||null===a)throw Error((0,h.sprintf)(o.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));Object.keys(a).forEach(function(b){if(void 0===a[b])throw Error((0,h.sprintf)(o.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",b))})}(b),c&&function(a){if("object"!=typeof a||Array.isArray(a)||null===a)throw Error((0,h.sprintf)(o.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"))}(c),!0}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),!1}},a.prototype.notActivatingExperiment=function(a,b){return this.logger.log(n.INFO,p.NOT_ACTIVATING_USER,"OPTIMIZELY",b,a),null},a.prototype.filterEmptyValues=function(a){for(var b in a)a.hasOwnProperty(b)&&(null===a[b]|| void 0===a[b])&&delete a[b];return a},a.prototype.isFeatureEnabled=function(a,b,c){try{if(!this.isValidInstance())return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","isFeatureEnabled"),!1;if(!this.validateInputs({feature_key:a,user_id:b},c))return!1;var d=this.projectConfigManager.getConfig();if(!d)return!1;var e=$(d,a,this.logger);if(!e)return!1;var f={},g=this.createUserContext(b,c),h=this.decisionService.getVariationForFeature(d,e,g).result,i=h.decisionSource,j=aH(h),k=aI(h),l=aJ(h);i===t.FEATURE_TEST&&(f={experimentKey:j,variationKey:k}),(i===t.FEATURE_TEST||i===t.ROLLOUT&&ab(d))&&this.sendImpressionEvent(h,e.key,b,l,c),!0===l?this.logger.log(n.INFO,p.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",a,b):(this.logger.log(n.INFO,p.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",a,b),l=!1);var m={featureKey:a,featureEnabled:l,source:h.decisionSource,sourceInfo:f};return this.notificationCenter.sendNotifications(r.DECISION,{type:s.FEATURE,userId:b,attributes:c||{},decisionInfo:m}),l}catch(o){return this.logger.log(n.ERROR,o.message),this.errorHandler.handleError(o),!1}},a.prototype.getEnabledFeatures=function(a,b){var c=this;try{var d=[];if(!this.isValidInstance())return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getEnabledFeatures"),d;if(!this.validateInputs({user_id:a}))return d;var e=this.projectConfigManager.getConfig();return e&&(0,h.objectValues)(e.featureKeyMap).forEach(function(e){c.isFeatureEnabled(e.key,a,b)&&d.push(e.key)}),d}catch(f){return this.logger.log(n.ERROR,f.message),this.errorHandler.handleError(f),[]}},a.prototype.getFeatureVariable=function(a,b,c,d){try{return this.isValidInstance()?this.getFeatureVariableForType(a,b,null,c,d):(this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariable"),null)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),null}},a.prototype.getFeatureVariableForType=function(a,b,c,d,e){if(!this.validateInputs({feature_key:a,variable_key:b,user_id:d},e))return null;var f=this.projectConfigManager.getConfig();if(!f)return null;var g=$(f,a,this.logger);if(!g)return null;var h,i,j,k,l,m=(h=f,i=a,j=b,k=this.logger,l=h.featureKeyMap[i],l?l.variableKeyMap[j]||(k.log(n.ERROR,o.VARIABLE_KEY_NOT_IN_DATAFILE,P,j,i),null):(k.log(n.ERROR,o.FEATURE_NOT_IN_DATAFILE,P,i),null));if(!m)return null;if(c&&m.type!==c)return this.logger.log(n.WARNING,p.VARIABLE_REQUESTED_WITH_WRONG_TYPE,"OPTIMIZELY",c,m.type),null;var q=this.createUserContext(d,e),u=this.decisionService.getVariationForFeature(f,g,q).result,v=aJ(u),w=this.getFeatureVariableValueFromVariation(a,v,u.variation,m,d),x={};return u.decisionSource===t.FEATURE_TEST&&null!==u.experiment&&null!==u.variation&&(x={experimentKey:u.experiment.key,variationKey:u.variation.key}),this.notificationCenter.sendNotifications(r.DECISION,{type:s.FEATURE_VARIABLE,userId:d,attributes:e||{},decisionInfo:{featureKey:a,featureEnabled:v,source:u.decisionSource,variableKey:b,variableValue:w,variableType:m.type,sourceInfo:x}}),w},a.prototype.getFeatureVariableValueFromVariation=function(a,b,c,d,e){var f=this.projectConfigManager.getConfig();if(!f)return null;var g=d.defaultValue;if(null!==c){var h=function(a,b,c,d){if(!b||!c)return null;if(!a.variationVariableUsageMap.hasOwnProperty(c.id))return d.log(n.ERROR,o.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,P,c.id),null;var e=a.variationVariableUsageMap[c.id][b.id];return e?e.value:null}(f,d,c,this.logger);null!==h?b?(g=h,this.logger.log(n.INFO,p.USER_RECEIVED_VARIABLE_VALUE,"OPTIMIZELY",g,d.key,a)):this.logger.log(n.INFO,p.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",a,e,g):this.logger.log(n.INFO,p.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",d.key,c.key)}else this.logger.log(n.INFO,p.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,"OPTIMIZELY",e,d.key,a);return function(a,b,c){var d;switch(b){case v.BOOLEAN:"true"!==a&&"false"!==a?(c.log(n.ERROR,o.UNABLE_TO_CAST_VALUE,P,a,b),d=null):d="true"===a;break;case v.INTEGER:d=parseInt(a,10),isNaN(d)&&(c.log(n.ERROR,o.UNABLE_TO_CAST_VALUE,P,a,b),d=null);break;case v.DOUBLE:d=parseFloat(a),isNaN(d)&&(c.log(n.ERROR,o.UNABLE_TO_CAST_VALUE,P,a,b),d=null);break;case v.JSON:try{d=JSON.parse(a)}catch(e){c.log(n.ERROR,o.UNABLE_TO_CAST_VALUE,P,a,b),d=null}break;default:d=a}return d}(g,d.type,this.logger)},a.prototype.getFeatureVariableBoolean=function(a,b,c,d){try{return this.isValidInstance()?this.getFeatureVariableForType(a,b,v.BOOLEAN,c,d):(this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableBoolean"),null)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),null}},a.prototype.getFeatureVariableDouble=function(a,b,c,d){try{return this.isValidInstance()?this.getFeatureVariableForType(a,b,v.DOUBLE,c,d):(this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableDouble"),null)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),null}},a.prototype.getFeatureVariableInteger=function(a,b,c,d){try{return this.isValidInstance()?this.getFeatureVariableForType(a,b,v.INTEGER,c,d):(this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableInteger"),null)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),null}},a.prototype.getFeatureVariableString=function(a,b,c,d){try{return this.isValidInstance()?this.getFeatureVariableForType(a,b,v.STRING,c,d):(this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableString"),null)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),null}},a.prototype.getFeatureVariableJSON=function(a,b,c,d){try{return this.isValidInstance()?this.getFeatureVariableForType(a,b,v.JSON,c,d):(this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getFeatureVariableJSON"),null)}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),null}},a.prototype.getAllFeatureVariables=function(a,b,c){var d=this;try{if(!this.isValidInstance())return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","getAllFeatureVariables"),null;if(!this.validateInputs({feature_key:a,user_id:b},c))return null;var e=this.projectConfigManager.getConfig();if(!e)return null;var f=$(e,a,this.logger);if(!f)return null;var g=this.createUserContext(b,c),h=this.decisionService.getVariationForFeature(e,f,g).result,i=aJ(h),j={};f.variables.forEach(function(c){j[c.key]=d.getFeatureVariableValueFromVariation(a,i,h.variation,c,b)});var k={};return h.decisionSource===t.FEATURE_TEST&&null!==h.experiment&&null!==h.variation&&(k={experimentKey:h.experiment.key,variationKey:h.variation.key}),this.notificationCenter.sendNotifications(r.DECISION,{type:s.ALL_FEATURE_VARIABLES,userId:b,attributes:c||{},decisionInfo:{featureKey:a,featureEnabled:i,source:h.decisionSource,variableValues:j,sourceInfo:k}}),j}catch(l){return this.logger.log(n.ERROR,l.message),this.errorHandler.handleError(l),null}},a.prototype.getOptimizelyConfig=function(){try{return this.projectConfigManager.getConfig()?this.projectConfigManager.getOptimizelyConfig():null}catch(a){return this.logger.log(n.ERROR,a.message),this.errorHandler.handleError(a),null}},a.prototype.close=function(){var a=this;try{var b=this.eventProcessor.stop();return this.disposeOnUpdate&&(this.disposeOnUpdate(),this.disposeOnUpdate=null),this.projectConfigManager&&this.projectConfigManager.stop(),Object.keys(this.readyTimeouts).forEach(function(b){var c=a.readyTimeouts[b];clearTimeout(c.readyTimeout),c.onClose()}),this.readyTimeouts={},b.then(function(){return{success:!0}},function(a){return{success:!1,reason:String(a)}})}catch(c){return this.logger.log(n.ERROR,c.message),this.errorHandler.handleError(c),Promise.resolve({success:!1,reason:String(c)})}},a.prototype.onReady=function(a){var b,c,d=this;"object"==typeof a&&null!==a&& void 0!==a.timeout&&(b=a.timeout),O.isSafeInteger(b)||(b=3e4);var e=new Promise(function(a){c=a}),f=this.nextReadyTimeoutId;this.nextReadyTimeoutId++;var g=setTimeout(function(){delete d.readyTimeouts[f],c({success:!1,reason:(0,h.sprintf)("onReady timeout expired after %s ms",b)})},b);return this.readyTimeouts[f]={readyTimeout:g,onClose:function(){c({success:!1,reason:"Instance closed"})}},this.readyPromise.then(function(){clearTimeout(g),delete d.readyTimeouts[f],c({success:!0})}),Promise.race([this.readyPromise,e])},a.prototype.createUserContext=function(a,b){return this.validateInputs({user_id:a},b)?new K({optimizely:this,userId:a,attributes:b}):null},a.prototype.decide=function(a,b,c){var d,e,f,g,i=this;void 0===c&&(c=[]);var j,k=a.getUserId(),l=a.getAttributes(),q=this.projectConfigManager.getConfig(),u=[];if(!this.isValidInstance()||!q)return this.logger.log(n.INFO,p.INVALID_OBJECT,"OPTIMIZELY","decide"),J(b,a,[x.SDK_NOT_READY]);var v=q.featureKeyMap[b];if(!v)return this.logger.log(n.ERROR,o.FEATURE_NOT_IN_DATAFILE,"OPTIMIZELY",b),J(b,a,[(0,h.sprintf)(x.FLAG_KEY_INVALID,b)]);var w=this.getAllDecideOptions(c),y=this.decisionService.findValidatedForcedDecision(q,a,b);u.push.apply(u,y.reasons);var z=y.result;if(z)j={experiment:null,variation:z,decisionSource:t.FEATURE_TEST};else{var A=this.decisionService.getVariationForFeature(q,v,a,w);u.push.apply(u,A.reasons),j=A.result}var B=j.decisionSource,C=null!==(e=null===(d=j.experiment)|| void 0===d?void 0:d.key)&& void 0!==e?e:null,D=null!==(g=null===(f=j.variation)|| void 0===f?void 0:f.key)&& void 0!==g?g:null,E=aJ(j);!0===E?this.logger.log(n.INFO,p.FEATURE_ENABLED_FOR_USER,"OPTIMIZELY",b,k):this.logger.log(n.INFO,p.FEATURE_NOT_ENABLED_FOR_USER,"OPTIMIZELY",b,k);var F={},G=!1;w[H.EXCLUDE_VARIABLES]||v.variables.forEach(function(a){F[a.key]=i.getFeatureVariableValueFromVariation(b,E,j.variation,a,k)}),!w[H.DISABLE_DECISION_EVENT]&&(B===t.FEATURE_TEST||B===t.ROLLOUT&&ab(q))&&(this.sendImpressionEvent(j,b,k,E,l),G=!0);var I=[];w[H.INCLUDE_REASONS]&&(I=u.map(function(a){return h.sprintf.apply(void 0,m([a[0]],a.slice(1)))}));var K={flagKey:b,enabled:E,variationKey:D,ruleKey:C,variables:F,reasons:I,decisionEventDispatched:G};return this.notificationCenter.sendNotifications(r.DECISION,{type:s.FLAG,userId:k,attributes:l,decisionInfo:K}),{variationKey:D,enabled:E,variables:F,ruleKey:C,flagKey:b,userContext:a,reasons:I}},a.prototype.getAllDecideOptions=function(a){var b=this,c=l({},this.defaultDecideOptions);return Array.isArray(a)?a.forEach(function(a){H[a]?c[a]=!0:b.logger.log(n.WARNING,p.UNRECOGNIZED_DECIDE_OPTION,"OPTIMIZELY",a)}):this.logger.log(n.DEBUG,p.INVALID_DECIDE_OPTIONS,"OPTIMIZELY"),c},a.prototype.decideForKeys=function(a,b,c){var d=this;void 0===c&&(c=[]);var e={};if(!this.isValidInstance())return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","decideForKeys"),e;if(0===b.length)return e;var f=this.getAllDecideOptions(c);return b.forEach(function(b){var g=d.decide(a,b,c);f[H.ENABLED_FLAGS_ONLY]&&!g.enabled||(e[b]=g)}),e},a.prototype.decideAll=function(a,b){void 0===b&&(b=[]);var c=this.projectConfigManager.getConfig();if(!this.isValidInstance()||!c)return this.logger.log(n.ERROR,p.INVALID_OBJECT,"OPTIMIZELY","decideAll"),{};var d=Object.keys(c.featureKeyMap);return this.decideForKeys(a,d,b)},a}(),aQ=function(){function a(a){var b=this;this.logger=a.logger,this.errorHandler=a.errorHandler,this.notificationListeners={},(0,h.objectValues)(r).forEach(function(a){b.notificationListeners[a]=[]}),this.listenerId=1}return a.prototype.addNotificationListener=function(a,b){try{if(!((0,h.objectValues)(r).indexOf(a)> -1))return -1;this.notificationListeners[a]||(this.notificationListeners[a]=[]);var c=!1;if((this.notificationListeners[a]||[]).forEach(function(a){a.callback!==b||(c=!0)}),c)return -1;this.notificationListeners[a].push({id:this.listenerId,callback:b});var d=this.listenerId;return this.listenerId+=1,d}catch(e){return this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e),-1}},a.prototype.removeNotificationListener=function(a){var b,c,d=this;try{if(Object.keys(this.notificationListeners).some(function(e){return(d.notificationListeners[e]||[]).every(function(d,f){return d.id!==a||(b=f,c=e,!1)}),void 0!==b&& void 0!==c}),void 0!==b&& void 0!==c)return this.notificationListeners[c].splice(b,1),!0}catch(e){this.logger.log(n.ERROR,e.message),this.errorHandler.handleError(e)}return!1},a.prototype.clearAllNotificationListeners=function(){var a=this;try{(0,h.objectValues)(r).forEach(function(b){a.notificationListeners[b]=[]})}catch(b){this.logger.log(n.ERROR,b.message),this.errorHandler.handleError(b)}},a.prototype.clearNotificationListeners=function(a){try{this.notificationListeners[a]=[]}catch(b){this.logger.log(n.ERROR,b.message),this.errorHandler.handleError(b)}},a.prototype.sendNotifications=function(a,b){var c=this;try{(this.notificationListeners[a]||[]).forEach(function(d){var e=d.callback;try{e(b)}catch(f){c.logger.log(n.ERROR,p.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",a,f.message)}})}catch(d){this.logger.log(n.ERROR,d.message),this.errorHandler.handleError(d)}},a}(),aR={createEventProcessor:function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return new(g.LogTierV1EventProcessor.bind.apply(g.LogTierV1EventProcessor,m([void 0],a)))},LocalStoragePendingEventsDispatcher:g.LocalStoragePendingEventsDispatcher},aS=(0,f.getLogger)();(0,f.setLogHandler)(F()),(0,f.setLogLevel)(f.LogLevel.INFO);var aT=!1,aU={logging:I,errorHandler:{handleError:function(){}},eventDispatcher:D,enums:y,setLogger:f.setLogHandler,setLogLevel:f.setLogLevel,createInstance:function(a){try{a.errorHandler&&(0,f.setErrorHandler)(a.errorHandler),a.logger&&((0,f.setLogHandler)(a.logger),(0,f.setLogLevel)(f.LogLevel.NOTSET)),void 0!==a.logLevel&&(0,f.setLogLevel)(a.logLevel);try{B(a),a.isValidInstance=!0}catch(b){aS.error(b),a.isValidInstance=!1}var c=void 0;null==a.eventDispatcher?(c=new g.LocalStoragePendingEventsDispatcher({eventDispatcher:D}),aT||(c.sendPendingEvents(),aT=!0)):c=a.eventDispatcher;var d,e,h=a.eventBatchSize,i=a.eventFlushInterval;d=a.eventBatchSize,!("number"!=typeof d||!O.isSafeInteger(d))&&d>=1||(aS.warn("Invalid eventBatchSize %s, defaulting to %s",a.eventBatchSize,10),h=10),e=a.eventFlushInterval,!("number"!=typeof e||!O.isSafeInteger(e))&&e>0||(aS.warn("Invalid eventFlushInterval %s, defaulting to %s",a.eventFlushInterval,1e3),i=1e3);var j=(0,f.getErrorHandler)(),m=new aQ({logger:aS,errorHandler:j}),n={dispatcher:c,flushInterval:i,batchSize:h,maxQueueSize:a.eventMaxQueueSize||1e4,notificationCenter:m},o=l(l({clientEngine:"javascript-sdk"},a),{eventProcessor:aR.createEventProcessor(n),logger:aS,errorHandler:j,datafileManager:a.sdkKey?function(a,b,c,d){var e={sdkKey:a};if((void 0===d||"object"==typeof d&&null!==d)&&O.assign(e,d),c){var f=aa({datafile:c,jsonSchemaValidator:void 0,logger:b}),g=f.configObj,h=f.error;h&&b.error(h),g&&(e.datafile=_(g))}return new k.z(e)}(a.sdkKey,aS,a.datafile,a.datafileOptions):void 0,notificationCenter:m}),q=new aP(o);try{if("function"==typeof window.addEventListener){var r="onpagehide"in window?"pagehide":"unload";window.addEventListener(r,function(){q.close()},!1)}}catch(s){aS.error(p.UNABLE_TO_ATTACH_UNLOAD,"INDEX_BROWSER",s.message)}return q}catch(t){return aS.error(t),null}},__internalResetRetryState:function(){aT=!1},OptimizelyDecideOption:H};let aV=aU},59753(a,b,c){"use strict";function d(){if(!(this instanceof d))return new d;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}c.d(b,{f:()=>B,on:()=>A});var e,f=window.document.documentElement,g=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector;d.prototype.matchesSelector=function(a,b){return g.call(a,b)},d.prototype.querySelectorAll=function(a,b){return b.querySelectorAll(a)},d.prototype.indexes=[];var h=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;d.prototype.indexes.push({name:"ID",selector:function(a){var b;if(b=a.match(h))return b[0].slice(1)},element:function(a){if(a.id)return[a.id]}});var i=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;d.prototype.indexes.push({name:"CLASS",selector:function(a){var b;if(b=a.match(i))return b[0].slice(1)},element:function(a){var b=a.className;if(b){if("string"==typeof b)return b.split(/\s/);if("object"==typeof b&&"baseVal"in b)return b.baseVal.split(/\s/)}}});var j=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;d.prototype.indexes.push({name:"TAG",selector:function(a){var b;if(b=a.match(j))return b[0].toUpperCase()},element:function(a){return[a.nodeName.toUpperCase()]}}),d.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}},e="function"==typeof window.Map?window.Map:function(){function a(){this.map={}}return a.prototype.get=function(a){return this.map[a+" "]},a.prototype.set=function(a,b){this.map[a+" "]=b},a}();var k=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function l(a,b){var c,d,e,f,g,h,i=(a=a.slice(0).concat(a.default)).length,j=b,l=[];do if(k.exec(""),(e=k.exec(j))&&(j=e[3],e[2]||!j)){for(c=0;c<i;c++)if(g=(h=a[c]).selector(e[1])){for(d=l.length,f=!1;d--;)if(l[d].index===h&&l[d].key===g){f=!0;break}f||l.push({index:h,key:g});break}}while(e)return l}function m(a,b){var c,d,e;for(c=0,d=a.length;c<d;c++)if(e=a[c],b.isPrototypeOf(e))return e}function n(a,b){return a.id-b.id}d.prototype.logDefaultIndexUsed=function(){},d.prototype.add=function(a,b){var c,d,f,g,h,i,j,k,n=this.activeIndexes,o=this.selectors,p=this.selectorObjects;if("string"==typeof a){for(d=0,p[(c={id:this.uid++,selector:a,data:b}).id]=c,j=l(this.indexes,a);d<j.length;d++)g=(k=j[d]).key,f=k.index,h=m(n,f),h||((h=Object.create(f)).map=new e,n.push(h)),f===this.indexes.default&&this.logDefaultIndexUsed(c),i=h.map.get(g),i||(i=[],h.map.set(g,i)),i.push(c);this.size++,o.push(a)}},d.prototype.remove=function(a,b){if("string"==typeof a){var c,d,e,f,g,h,i,j,k=this.activeIndexes,m=this.selectors=[],n=this.selectorObjects,o={},p=1===arguments.length;for(e=0,c=l(this.indexes,a);e<c.length;e++)for(d=c[e],f=k.length;f--;)if(h=k[f],d.index.isPrototypeOf(h)){if(i=h.map.get(d.key))for(g=i.length;g--;)(j=i[g]).selector===a&&(p||j.data===b)&&(i.splice(g,1),o[j.id]=!0);break}for(e in o)delete n[e],this.size--;for(e in n)m.push(n[e].selector)}},d.prototype.queryAll=function(a){if(!this.selectors.length)return[];var b,c,d,e,f,g,h,i,j={},k=[],l=this.querySelectorAll(this.selectors.join(", "),a);for(b=0,d=l.length;b<d;b++)for(c=0,f=l[b],e=(g=this.matches(f)).length;c<e;c++)j[(i=g[c]).id]?h=j[i.id]:(h={id:i.id,selector:i.selector,data:i.data,elements:[]},j[i.id]=h,k.push(h)),h.elements.push(f);return k.sort(n)},d.prototype.matches=function(a){if(!a)return[];var b,c,d,e,f,g,h,i,j,k,l,m=this.activeIndexes,o={},p=[];for(b=0,e=m.length;b<e;b++)if(i=(h=m[b]).element(a)){for(c=0,f=i.length;c<f;c++)if(j=h.map.get(i[c]))for(d=0,g=j.length;d<g;d++)!o[l=(k=j[d]).id]&&this.matchesSelector(a,k.selector)&&(o[l]=!0,p.push(k))}return p.sort(n)};var o={},p={},q=new WeakMap,r=new WeakMap,s=new WeakMap,t=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function u(a,b,c){var d=a[b];return a[b]=function(){return c.apply(a,arguments),d.apply(a,arguments)},a}function v(){q.set(this,!0)}function w(){q.set(this,!0),r.set(this,!0)}function x(){return s.get(this)||null}function y(a,b){t&&Object.defineProperty(a,"currentTarget",{configurable:!0,enumerable:!0,get:b||t.get})}function z(a){if(function(a){try{return a.eventPhase,!0}catch(b){return!1}}(a)){var b=(1===a.eventPhase?p:o)[a.type];if(b){var c=function(a,b,c){var d=[],e=b;do{if(1!==e.nodeType)break;var f=a.matches(e);if(f.length){var g={node:e,observers:f};c?d.unshift(g):d.push(g)}}while(e=e.parentElement)return d}(b,a.target,1===a.eventPhase);if(c.length){u(a,"stopPropagation",v),u(a,"stopImmediatePropagation",w),y(a,x);for(var d=0,e=c.length;d<e&&!q.get(a);d++){var f=c[d];s.set(a,f.node);for(var g=0,h=f.observers.length;g<h&&!r.get(a);g++)f.observers[g].data.call(f.node,a)}s.delete(a),y(a)}}}}function A(a,b,c){var e=arguments.length>3&& void 0!==arguments[3]?arguments[3]:{},f=!!e.capture,g=f?p:o,h=g[a];h||(h=new d,g[a]=h,document.addEventListener(a,z,f)),h.add(b,c)}function B(a,b,c){return a.dispatchEvent(new CustomEvent(b,{bubbles:!0,cancelable:!0,detail:c}))}},58053(a){!function(){function b(a,b){var c,d,e,f,g,h,i,j;for(c=3&a.length,d=a.length-c,e=b,g=3432918353,h=461845907,j=0;j<d;)i=255&a.charCodeAt(j)|(255&a.charCodeAt(++j))<<8|(255&a.charCodeAt(++j))<<16|(255&a.charCodeAt(++j))<<24,++j,e^=i=(65535&(i=(i=(65535&i)*g+(((i>>>16)*g&65535)<<16)&4294967295)<<15|i>>>17))*h+(((i>>>16)*h&65535)<<16)&4294967295,e=(65535&(f=(65535&(e=e<<13|e>>>19))*5+(((e>>>16)*5&65535)<<16)&4294967295))+27492+(((f>>>16)+58964&65535)<<16);switch(i=0,c){case 3:i^=(255&a.charCodeAt(j+2))<<16;case 2:i^=(255&a.charCodeAt(j+1))<<8;case 1:i^=255&a.charCodeAt(j),e^=i=(65535&(i=(i=(65535&i)*g+(((i>>>16)*g&65535)<<16)&4294967295)<<15|i>>>17))*h+(((i>>>16)*h&65535)<<16)&4294967295}return e^=a.length,e^=e>>>16,e=(65535&e)*2246822507+(((e>>>16)*2246822507&65535)<<16)&4294967295,e^=e>>>13,e=(65535&e)*3266489909+(((e>>>16)*3266489909&65535)<<16)&4294967295,(e^=e>>>16)>>>0}var c=b;c.v2=function(a,b){for(var c,d=a.length,e=b^d,f=0;d>=4;)c=(65535&(c=255&a.charCodeAt(f)|(255&a.charCodeAt(++f))<<8|(255&a.charCodeAt(++f))<<16|(255&a.charCodeAt(++f))<<24))*1540483477+(((c>>>16)*1540483477&65535)<<16),c^=c>>>24,e=(65535&e)*1540483477+(((e>>>16)*1540483477&65535)<<16)^(c=(65535&c)*1540483477+(((c>>>16)*1540483477&65535)<<16)),d-=4,++f;switch(d){case 3:e^=(255&a.charCodeAt(f+2))<<16;case 2:e^=(255&a.charCodeAt(f+1))<<8;case 1:e^=255&a.charCodeAt(f),e=(65535&e)*1540483477+(((e>>>16)*1540483477&65535)<<16)}return e^=e>>>13,e=(65535&e)*1540483477+(((e>>>16)*1540483477&65535)<<16),(e^=e>>>15)>>>0},c.v3=b,a.exports=c}()},82918(a,b,c){"use strict";c.d(b,{b:()=>f});let d;function e(){return`${Math.round(2147483647*Math.random())}.${Math.round(Date.now()/1e3)}`}function f(){try{let a=function(){let a,b=document.cookie,c=b.match(/_octo=([^;]+)/g);if(!c)return;let d=[0,0];for(let e of c){let[,f]=e.split("="),[,g,...h]=f.split("."),i=g.split("-").map(Number);i>d&&(d=i,a=h.join("."))}return a}();if(a)return a;let b=e();return!function(a){let b=`GH1.1.${a}`,c=Date.now(),d=new Date(c+31536e6).toUTCString(),{domain:e}=document;e.endsWith(".github.com")&&(e="github.com"),document.cookie=`_octo=${b}; expires=${d}; path=/; domain=${e}; secure; samesite=lax`}(b),b}catch(c){return d||(d=e()),d}}}}])
//# sourceMappingURL=vendors-node_modules_optimizely_optimizely-sdk_dist_optimizely_browser_es_min_js-node_modules-4de5ed-f74b62ec4aa7.js.map